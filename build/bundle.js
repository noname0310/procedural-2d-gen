(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var i=t.g.document;if(!e&&i&&(i.currentScript&&(e=i.currentScript.src),!e)){var s=i.getElementsByTagName("script");s.length&&(e=s[s.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})();class e{}class i extends e{static get instance(){return i._instance}}i._instance=new i;class s extends e{constructor(t){super(),this.Yt=t}get seconds(){return this.Yt}}class r extends e{constructor(t){super(),this.Et=t}get predicate(){return this.Et}}class h extends e{constructor(t){super(),this.Et=t}get predicate(){return this.Et}}class n{constructor(t){this.o=t,this.Wt=[],this.Ft=0}addCoroutine(t){this.Wt.push(t),this.Ft+=1}removeCoroutine(t){const e=this.Wt.indexOf(t);e>=0&&(this.Wt[e]=null,this.Ft-=1)}tryCompact(){const t=this.Wt;if(n._needToCompactCount<=t.length-this.Ft){let e=0;for(let i=0;i<t.length;++i){const s=t[i];null!==s&&(t[e]=s,e+=1)}t.length=this.Ft}}updateAfterProcess(){const t=this.Wt;for(let e=0;e<t.length;++e){const i=t[e];null!==i&&(i.currentYieldInstructionExist?this.Pt(i):(t[e]=null,this.Ft-=1))}}Pt(t){const e=t.currentYieldInstruction;e instanceof s?(t.elapsedTime+=this.o.deltaTime,t.elapsedTime>=e.seconds&&(t.elapsedTime=0,t.fatchNextInstruction())):e instanceof r?e.predicate()&&t.fatchNextInstruction():e instanceof h?e.predicate()||t.fatchNextInstruction():null===e&&t.fatchNextInstruction()}endFrameAfterProcess(){const t=this.Wt;for(let e=0;e<t.length;++e){const i=t[e];null!==i&&(i.currentYieldInstructionExist?this.Ct(i):(t[e]=null,this.Ft-=1))}}Ct(t){t.currentYieldInstruction instanceof i&&t.fatchNextInstruction()}}n._needToCompactCount=16;class o{constructor(t){this.next=null,this.prev=null,this.value=t}}class a{constructor(){this.tt=!1,this.st=null,this.it=null,this.et=0}get length(){return this.et}add(t){const e=new o(t);null===this.st?(this.st=e,this.it=e):(this.it.next=e,e.prev=this.it,this.it=e),this.et++}lt(t){null!==t.prev?t.prev.next=t.next:this.st=t.next,null!==t.next?t.next.prev=t.prev:this.it=t.prev,this.et--}remove(t){let e=this.st;for(;null!==e;){if(e.value===t)return void this.lt(e);e=e.next}}removeAll(){this.st=null,this.it=null,this.et=0,this.tt=!0}forEach(t){this.tt=!1;let e=this.st;for(;null!==e;)if(t(e.value),this.tt){if(null===this.st)return;e=this.st,this.tt=!1}else e=e.next}}class l{constructor(){this.ht=new a}addListener(t){this.ht.add(t)}removeListener(t){this.ht.remove(t)}removeAllListeners(){this.ht.removeAll()}invoke(...t){this.ht.forEach((e=>{e(...t)}))}get length(){return this.ht.length}}class c{constructor(t){this.Ks=new l,this.ks=new l,this.Hs=new l,this.Is=new l,this.Xs=new l,this.Ys=new l,this.zs=new l,this.Gs=new l,this.Js=!1,this.Zs=null,this.$s=null,this.he=null,this.ue=t=>{const e=1===t.key.length?t.key.toLowerCase():t.key;this.le.set(e,!0),this.Ks.invoke(t)},this.we=t=>{const e=1===t.key.length?t.key.toLowerCase():t.key;this.le.set(e,!1),this.ks.invoke(t)},this.ve=t=>{this.Hs.invoke(t)},this.me=t=>{this.$s=t,this.Is.invoke(t)},this.de=t=>{this.$s=null,this.Xs.invoke(t)},this.fe=t=>{this.he=t,this.Ys.invoke(t)},this.pe=t=>{this.he=null,this.zs.invoke(t)},this.Ee=t=>{this.$s=t,this.Gs.invoke(t)},this.ge=t=>{this.Zs=()=>{this.ye("mouseenter",t.touches[0]),this.ye("mousedown",t.touches[0])}},this.Ce=t=>{this.Js&&(this.Js=!1,this.ye("mouseup",t.changedTouches[0]),this.ye("mouseleave",t.changedTouches[0]))},this.Ke=t=>{this.Zs&&(this.Zs(),this.Zs=null),this.ye("mousemove",t.touches[0]),this.Js=!0},this.be=t=>{this.Js&&(this.Js=!1,this.ye("mouseleave",t.changedTouches[0]))},this.le=new Map,this.D=!1,this.Pe=t}get map(){return this.le}dispose(){this.stopHandleEvents(),this.D=!0}startHandleEvents(){if(this.D)throw new Error("InputHandler is disposed.");window.addEventListener("keydown",this.ue),window.addEventListener("keyup",this.we),window.addEventListener("wheel",this.ve),this.Pe.addEventListener("mousedown",this.me),this.Pe.addEventListener("mouseup",this.de),this.Pe.addEventListener("mouseenter",this.fe),this.Pe.addEventListener("mouseleave",this.pe),this.Pe.addEventListener("mousemove",this.Ee),this.Pe.addEventListener("touchstart",this.ge),this.Pe.addEventListener("touchend",this.Ce),this.Pe.addEventListener("touchmove",this.Ke),this.Pe.addEventListener("touchcancel",this.be)}stopHandleEvents(){this.$s&&this.de(this.$s),this.he&&this.pe(this.he),this.le.clear(),window.removeEventListener("keydown",this.ue),window.removeEventListener("keyup",this.we),window.removeEventListener("wheel",this.ve),this.Pe.removeEventListener("mousedown",this.me),this.Pe.removeEventListener("mouseup",this.de),this.Pe.removeEventListener("mouseenter",this.fe),this.Pe.removeEventListener("mouseleave",this.pe),this.Pe.removeEventListener("mousemove",this.Ee),this.Pe.removeEventListener("touchstart",this.ge),this.Pe.removeEventListener("touchend",this.Ce),this.Pe.removeEventListener("touchmove",this.Ke),this.Pe.removeEventListener("touchcancel",this.be)}ye(t,e){const i=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,detail:1,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0,relatedTarget:null});e.target.dispatchEvent(i)}get onKeyDown(){return this.Ks}get onKeyUp(){return this.ks}get onWheel(){return this.Hs}get onPointerDown(){return this.Is}get onPointerUp(){return this.Xs}get onPointerEnter(){return this.Ys}get onPointerLeave(){return this.zs}get onPointerMove(){return this.Gs}}const u=function(){function t(t,e){this.color=!0,this.key=void 0,this.value=void 0,this.left=void 0,this.right=void 0,this.parent=void 0,this.key=t,this.value=e}return t.prototype.pre=function(){var e=this;if(e.color===t.RED&&e.parent.parent===e)e=e.right;else if(e.left)for(e=e.left;e.right;)e=e.right;else{for(var i=e.parent;i.left===e;)i=(e=i).parent;e=i}return e},t.prototype.next=function(){var t=this;if(t.right)for(t=t.right;t.left;)t=t.left;else{for(var e=t.parent;e.right===t;)e=(t=e).parent;t.right!==e&&(t=e)}return t},t.prototype.rotateLeft=function(){var t=this.parent,e=this.right,i=e.left;return t.parent===this?t.parent=e:t.left===this?t.left=e:t.right=e,e.parent=t,e.left=this,this.parent=e,this.right=i,i&&(i.parent=this),e},t.prototype.rotateRight=function(){var t=this.parent,e=this.left,i=e.right;return t.parent===this?t.parent=e:t.left===this?t.left=e:t.right=e,e.parent=t,e.right=this,this.parent=e,this.left=i,i&&(i.parent=this),e},t.prototype.remove=function(){var t=this.parent;this===t.left?t.left=void 0:t.right=void 0},t.RED=!0,t.BLACK=!1,t}();var d,m=(d=function(t,e){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},d(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}d(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),p=function(){function t(e){void 0===e&&(e=t.NORMAL),this.iteratorType=e}return t.NORMAL=!1,t.REVERSE=!0,t}(),g=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return m(e,t),e}(function(){function t(){this.length=0}return t.prototype.size=function(){return this.length},t.prototype.empty=function(){return 0===this.length},t}());function f(t,e,i){if(t<e||t>i)throw new RangeError}var y=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),x=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var s,r,h=i.call(t),n=[];try{for(;(void 0===e||e-- >0)&&!(s=h.next()).done;)n.push(s.value)}catch(t){r={error:t}}finally{try{s&&!s.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}return n};const v=function(t){function e(e){void 0===e&&(e=function(t,e){return t<e?-1:t>e?1:0});var i=t.call(this)||this;return i.root=void 0,i.header=new u,i.inOrderTraversal=function(t,e){return void 0!==t&&(!!i.inOrderTraversal(t.left,e)||!!e(t)||i.inOrderTraversal(t.right,e))},i.cmp=e,i}return y(e,t),e.prototype._lowerBound=function(t,e){for(var i;t;){var s=this.cmp(t.key,e);if(s<0)t=t.right;else{if(!(s>0))return t;i=t,t=t.left}}return void 0===i?this.header:i},e.prototype._upperBound=function(t,e){for(var i;t;){var s=this.cmp(t.key,e);s<=0?t=t.right:s>0&&(i=t,t=t.left)}return void 0===i?this.header:i},e.prototype._reverseLowerBound=function(t,e){for(var i;t;){var s=this.cmp(t.key,e);if(s<0)i=t,t=t.right;else{if(!(s>0))return t;t=t.left}}return void 0===i?this.header:i},e.prototype._reverseUpperBound=function(t,e){for(var i;t;){var s=this.cmp(t.key,e);s<0?(i=t,t=t.right):s>=0&&(t=t.left)}return void 0===i?this.header:i},e.prototype.eraseNodeSelfBalance=function(t){for(;;){var e,i=t.parent;if(i===this.header)return;if(t.color===u.RED)return void(t.color=u.BLACK);if(t===i.left){if((e=i.right).color===u.RED)e.color=u.BLACK,i.color=u.RED,i===this.root?this.root=i.rotateLeft():i.rotateLeft();else if(e.color===u.BLACK){if(e.right&&e.right.color===u.RED)return e.color=i.color,i.color=u.BLACK,e.right.color=u.BLACK,void(i===this.root?this.root=i.rotateLeft():i.rotateLeft());e.left&&e.left.color===u.RED?(e.color=u.RED,e.left.color=u.BLACK,e.rotateRight()):(e.color=u.RED,t=i)}}else if((e=i.left).color===u.RED)e.color=u.BLACK,i.color=u.RED,i===this.root?this.root=i.rotateRight():i.rotateRight();else{if(e.left&&e.left.color===u.RED)return e.color=i.color,i.color=u.BLACK,e.left.color=u.BLACK,void(i===this.root?this.root=i.rotateRight():i.rotateRight());e.right&&e.right.color===u.RED?(e.color=u.RED,e.right.color=u.BLACK,e.rotateLeft()):(e.color=u.RED,t=i)}}},e.prototype.eraseNode=function(t){var e,i;if(1!==this.length){for(var s=t;s.left||s.right;){if(s.right)for(s=s.right;s.left;)s=s.left;else s.left&&(s=s.left);e=x([s.key,t.key],2),t.key=e[0],s.key=e[1],i=x([s.value,t.value],2),t.value=i[0],s.value=i[1],t=s}this.header.left===s?this.header.left=s.parent:this.header.right===s&&(this.header.right=s.parent),this.eraseNodeSelfBalance(s),s.remove(),this.length-=1,this.root.color=u.BLACK}else this.clear()},e.prototype.insertNodeSelfBalance=function(t){for(;;){var e=t.parent;if(e.color===u.BLACK)return;var i=e.parent;if(e===i.left){if((s=i.right)&&s.color===u.RED){if(s.color=e.color=u.BLACK,i===this.root)return;i.color=u.RED,t=i;continue}t===e.right?(t.color=u.BLACK,t.left&&(t.left.parent=e),t.right&&(t.right.parent=i),e.right=t.left,i.left=t.right,t.left=e,t.right=i,i===this.root?(this.root=t,this.header.parent=t):(r=i.parent).left===i?r.left=t:r.right=t,t.parent=i.parent,e.parent=t,i.parent=t):(e.color=u.BLACK,i===this.root?this.root=i.rotateRight():i.rotateRight()),i.color=u.RED}else{var s,r;if((s=i.left)&&s.color===u.RED){if(s.color=e.color=u.BLACK,i===this.root)return;i.color=u.RED,t=i;continue}if(t===e.left)t.color=u.BLACK,t.left&&(t.left.parent=i),t.right&&(t.right.parent=e),i.right=t.left,e.left=t.right,t.left=i,t.right=e,i===this.root?(this.root=t,this.header.parent=t):(r=i.parent).left===i?r.left=t:r.right=t,t.parent=i.parent,e.parent=t,i.parent=t;else e.color=u.BLACK,i===this.root?this.root=i.rotateLeft():i.rotateLeft();i.color=u.RED}return}},e.prototype.findElementNode=function(t,e){for(;t;){var i=this.cmp(t.key,e);if(i<0)t=t.right;else{if(!(i>0))return t;t=t.left}}return t},e.prototype.set=function(t,e,i){if(void 0===this.root)return this.length+=1,this.root=new u(t,e),this.root.color=u.BLACK,this.root.parent=this.header,this.header.parent=this.root,this.header.left=this.root,void(this.header.right=this.root);var s,r=this.header.left,h=this.cmp(r.key,t);if(0!==h){if(h>0)r.left=new u(t,e),r.left.parent=r,s=r.left,this.header.left=s;else{var n=this.header.right,o=this.cmp(n.key,t);if(0===o)return void(n.value=e);if(o<0)n.right=new u(t,e),n.right.parent=n,s=n.right,this.header.right=s;else{if(void 0!==i){var a=i.node;if(a!==this.header){var l=this.cmp(a.key,t);if(0===l)return void(a.value=e);if(l>0){var c=a.pre(),d=this.cmp(c.key,t);if(0===d)return void(c.value=e);d<0&&(s=new u(t,e),void 0===c.right?(c.right=s,s.parent=c):(a.left=s,s.parent=a))}}}if(void 0===s)for(s=this.root;;){var m=this.cmp(s.key,t);if(m>0){if(void 0===s.left){s.left=new u(t,e),s.left.parent=s,s=s.left;break}s=s.left}else{if(!(m<0))return void(s.value=e);if(void 0===s.right){s.right=new u(t,e),s.right.parent=s,s=s.right;break}s=s.right}}}}this.length+=1,this.insertNodeSelfBalance(s)}else r.value=e},e.prototype.clear=function(){this.length=0,this.root=void 0,this.header.parent=void 0,this.header.left=this.header.right=void 0},e.prototype.updateKeyByIterator=function(t,e){var i=t.node;if(i===this.header)throw new TypeError("Invalid iterator!");if(1===this.length)return i.key=e,!0;if(i===this.header.left)return this.cmp(i.next().key,e)>0&&(i.key=e,!0);if(i===this.header.right)return this.cmp(i.pre().key,e)<0&&(i.key=e,!0);var s=i.pre().key;if(this.cmp(s,e)>=0)return!1;var r=i.next().key;return!(this.cmp(r,e)<=0||(i.key=e,0))},e.prototype.eraseElementByPos=function(t){var e=this;f(t,0,this.length-1);var i=0;this.inOrderTraversal(this.root,(function(s){return t===i?(e.eraseNode(s),!0):(i+=1,!1)}))},e.prototype.eraseElementByKey=function(t){if(this.length){var e=this.findElementNode(this.root,t);void 0!==e&&this.eraseNode(e)}},e.prototype.eraseElementByIterator=function(t){var e=t.node;if(e===this.header)throw new RangeError("Invalid iterator");return void 0===e.right&&(t=t.next()),this.eraseNode(e),t},e.prototype.getHeight=function(){if(!this.length)return 0;var t=function(e){return e?Math.max(t(e.left),t(e.right))+1:0};return t(this.root)},e}(g);var w=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();const _=function(t){function e(e,i,s){var r=t.call(this,s)||this;return r.node=e,r.header=i,r.iteratorType===p.NORMAL?(r.pre=function(){if(this.node===this.header.left)throw new RangeError("LinkList iterator access denied!");return this.node=this.node.pre(),this},r.next=function(){if(this.node===this.header)throw new RangeError("LinkList iterator access denied!");return this.node=this.node.next(),this}):(r.pre=function(){if(this.node===this.header.right)throw new RangeError("LinkList iterator access denied!");return this.node=this.node.next(),this},r.next=function(){if(this.node===this.header)throw new RangeError("LinkList iterator access denied!");return this.node=this.node.pre(),this}),r}return w(e,t),e.prototype.equals=function(t){return this.node===t.node},e}(p);var M=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),C=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],s=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},b=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return M(e,t),Object.defineProperty(e.prototype,"pointer",{get:function(){if(this.node===this.header)throw new RangeError("OrderedSet iterator access denied!");return this.node.key},enumerable:!1,configurable:!0}),e.prototype.copy=function(){return new e(this.node,this.header,this.iteratorType)},e}(_);const E=function(t){function e(e,i){void 0===e&&(e=[]);var s=t.call(this,i)||this;return s.iterationFunc=function(t){return function(t,e){var i,s,r,h,n={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return h={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(h[Symbol.iterator]=function(){return this}),h;function o(h){return function(o){return function(h){if(i)throw new TypeError("Generator is already executing.");for(;n;)try{if(i=1,s&&(r=2&h[0]?s.return:h[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,h[1])).done)return r;switch(s=0,r&&(h=[2&h[0],r.value]),h[0]){case 0:case 1:r=h;break;case 4:return n.label++,{value:h[1],done:!1};case 5:n.label++,s=h[1],h=[0];continue;case 7:h=n.ops.pop(),n.trys.pop();continue;default:if(!((r=(r=n.trys).length>0&&r[r.length-1])||6!==h[0]&&2!==h[0])){n=0;continue}if(3===h[0]&&(!r||h[1]>r[0]&&h[1]<r[3])){n.label=h[1];break}if(6===h[0]&&n.label<r[1]){n.label=r[1],r=h;break}if(r&&n.label<r[2]){n.label=r[2],n.ops.push(h);break}r[2]&&n.ops.pop(),n.trys.pop();continue}h=e.call(t,n)}catch(t){h=[6,t],s=0}finally{i=r=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}([h,o])}}}(this,(function(e){switch(e.label){case 0:return void 0===t?[2]:[5,C(this.iterationFunc(t.left))];case 1:return e.sent(),[4,t.key];case 2:return e.sent(),[5,C(this.iterationFunc(t.right))];case 3:return e.sent(),[2]}}))},e.forEach((function(t){return s.insert(t)})),s.iterationFunc=s.iterationFunc.bind(s),s}return M(e,t),e.prototype.begin=function(){return new b(this.header.left||this.header,this.header)},e.prototype.end=function(){return new b(this.header,this.header)},e.prototype.rBegin=function(){return new b(this.header.right||this.header,this.header,p.REVERSE)},e.prototype.rEnd=function(){return new b(this.header,this.header,p.REVERSE)},e.prototype.front=function(){return this.header.left?this.header.left.key:void 0},e.prototype.back=function(){return this.header.right?this.header.right.key:void 0},e.prototype.forEach=function(t){var e,i,s=0;try{for(var r=C(this),h=r.next();!h.done;h=r.next())t(h.value,s++)}catch(t){e={error:t}}finally{try{h&&!h.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},e.prototype.getElementByPos=function(t){var e,i,s;f(t,0,this.length-1);var r=0;try{for(var h=C(this),n=h.next();!n.done;n=h.next()){var o=n.value;r===t&&(s=o),r+=1}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=h.return)&&i.call(h)}finally{if(e)throw e.error}}return s},e.prototype.insert=function(t,e){this.set(t,void 0,e)},e.prototype.find=function(t){var e=this.findElementNode(this.root,t);return void 0!==e?new b(e,this.header):this.end()},e.prototype.lowerBound=function(t){var e=this._lowerBound(this.root,t);return new b(e,this.header)},e.prototype.upperBound=function(t){var e=this._upperBound(this.root,t);return new b(e,this.header)},e.prototype.reverseLowerBound=function(t){var e=this._reverseLowerBound(this.root,t);return new b(e,this.header)},e.prototype.reverseUpperBound=function(t){var e=this._reverseUpperBound(this.root,t);return new b(e,this.header)},e.prototype.union=function(t){var e=this;t.forEach((function(t){return e.insert(t)}))},e.prototype[Symbol.iterator]=function(){return this.iterationFunc(this.root)},e}(v);class S{constructor(t){this.rt=null,this.nt=new E(void 0,t),this.dt=new E(void 0,t),this.ut=new E(void 0,t),this.ft=new E(void 0,t)}get size(){return this.nt.size()}insert(t){t.isRemoved=!1,null!==this.rt?this.dt.insert(t):this.nt.insert(t)}delete(t){null!==this.rt?(t.isRemoved=!0,this.ft.insert(t)):this.nt.eraseElementByKey(t)}clear(){this.nt.clear(),this.dt.clear(),this.ft.clear()}forEach(t){this.rt=this.nt,this.rt.forEach((e=>{e.isRemoved||t(e)}));do{this.rt=this.ot(),this.rt.forEach((e=>{e.isRemoved||t(e)}))}while(0<this.dt.size()||0<this.ft.size());this.rt=null}ot(){this.rt=null,this.ft.forEach((t=>this.delete(t))),this.dt.forEach((t=>this.insert(t)));const t=this.dt;return this.dt=this.ut,this.ut=t,this.dt.clear(),this.ft.clear(),t}}class O{constructor(t,e,i,s){this.isRemoved=!1,this.Dt=i,this.St=t.generateEventId(),this.kt=s,this.At=e}static createAwakeEvent(t,e){return new O(t,e,0,0)}static createStartEvent(t,e,i){return new O(t,e,2,i)}static createUpdateEvent(t,e,i){return new O(t,e,3,i)}static createOnEnableEvent(t,e,i){return new O(t,e,1,i)}static createOnDisableEvent(t,e,i){return new O(t,e,1,i)}static createOnDestroyEvent(t,e,i){return new O(t,e,4,i)}static createOnCollisionEnter2DEvent(t,e,i){return new O(t,e,1,i)}static createOnCollisionStay2DEvent(t,e,i){return new O(t,e,1,i)}static createOnCollisionExit2DEvent(t,e,i){return new O(t,e,1,i)}static createOnTriggerEnter2DEvent(t,e,i){return new O(t,e,1,i)}static createOnTriggerStay2DEvent(t,e,i){return new O(t,e,1,i)}static createOnTriggerExit2DEvent(t,e,i){return new O(t,e,1,i)}get invoke(){return this.At}static comparator(t,e){return t.Dt===e.Dt?t.kt===e.kt?t.St-e.St:t.kt-e.kt:t.Dt-e.Dt}}function k(t){return void 0!==t.onWorldMatrixUpdated}class z{constructor(){this.ti=new Set,this.ii=new S(O.comparator),this.ei=new S(O.comparator),this.ni=new S(O.comparator),this.oi=new S(O.comparator),this.ri=new S(O.comparator),this.si=new S(O.comparator)}registerComponent(t){k(t)&&this.ti.add(t);const e=t._engine_internal_componentEventContainer;e.onCollisionEnter2D&&this.ii.insert(e.onCollisionEnter2D),e.onCollisionStay2D&&this.ei.insert(e.onCollisionStay2D),e.onCollisionExit2D&&this.ni.insert(e.onCollisionExit2D),e.onTriggerEnter2D&&this.oi.insert(e.onTriggerEnter2D),e.onTriggerStay2D&&this.ri.insert(e.onTriggerStay2D),e.onTriggerExit2D&&this.si.insert(e.onTriggerExit2D)}unregisterComponent(t){k(t)&&this.ti.delete(t);const e=t._engine_internal_componentEventContainer;e.onCollisionEnter2D&&this.ii.delete(e.onCollisionEnter2D),e.onCollisionStay2D&&this.ei.delete(e.onCollisionStay2D),e.onCollisionExit2D&&this.ni.delete(e.onCollisionExit2D),e.onTriggerEnter2D&&this.oi.delete(e.onTriggerEnter2D),e.onTriggerStay2D&&this.ri.delete(e.onTriggerStay2D),e.onTriggerExit2D&&this.si.delete(e.onTriggerExit2D)}invokeOnWorldMatrixUpdated(){for(const t of this.ti)t.onWorldMatrixUpdated()}invokeOnCollisionEnter2D(t){0!==this.ii.size&&this.ii.forEach((e=>e.invoke(t)))}invokeOnCollisionStay2D(t){0!==this.ei.size&&this.ei.forEach((e=>e.invoke(t)))}invokeOnCollisionExit2D(t){0!==this.ni.size&&this.ni.forEach((e=>e.invoke(t)))}invokeOnTriggerEnter2D(t){0!==this.oi.size&&this.oi.forEach((e=>e.invoke(t)))}invokeOnTriggerStay2D(t){0!==this.ri.size&&this.ri.forEach((e=>e.invoke(t)))}invokeOnTriggerExit2D(t){0!==this.si.size&&this.si.forEach((e=>e.invoke(t)))}}const D=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],A=Math.PI/180,R=180/Math.PI;function P(t,e,i){return Math.max(e,Math.min(i,t))}function T(t,e,i,s){return function(t,e,i){return(1-i)*t+i*e}(t,e,1-Math.exp(-i*s))}class j{constructor(t=0,e=0,i=0,s=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=s}static slerpFlat(t,e,i,s,r,h,n){let o=i[s+0],a=i[s+1],l=i[s+2],c=i[s+3];const u=r[h+0],d=r[h+1],m=r[h+2],p=r[h+3];if(0===n)return t[e+0]=o,t[e+1]=a,t[e+2]=l,void(t[e+3]=c);if(1===n)return t[e+0]=u,t[e+1]=d,t[e+2]=m,void(t[e+3]=p);if(c!==p||o!==u||a!==d||l!==m){let t=1-n;const e=o*u+a*d+l*m+c*p,i=e>=0?1:-1,s=1-e*e;if(s>Number.EPSILON){const r=Math.sqrt(s),h=Math.atan2(r,e*i);t=Math.sin(t*h)/r,n=Math.sin(n*h)/r}const r=n*i;if(o=o*t+u*r,a=a*t+d*r,l=l*t+m*r,c=c*t+p*r,t===1-n){const t=1/Math.sqrt(o*o+a*a+l*l+c*c);o*=t,a*=t,l*=t,c*=t}}t[e]=o,t[e+1]=a,t[e+2]=l,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,s,r,h){const n=i[s],o=i[s+1],a=i[s+2],l=i[s+3],c=r[h],u=r[h+1],d=r[h+2],m=r[h+3];return t[e]=n*m+l*c+o*d-a*u,t[e+1]=o*m+l*u+a*c-n*d,t[e+2]=a*m+l*d+n*u-o*c,t[e+3]=l*m-n*c-o*u-a*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,s){return this._x=t,this._y=e,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const i=t._x,s=t._y,r=t._z,h=t._order,n=Math.cos,o=Math.sin,a=n(i/2),l=n(s/2),c=n(r/2),u=o(i/2),d=o(s/2),m=o(r/2);switch(h){case"XYZ":this._x=u*l*c+a*d*m,this._y=a*d*c-u*l*m,this._z=a*l*m+u*d*c,this._w=a*l*c-u*d*m;break;case"YXZ":this._x=u*l*c+a*d*m,this._y=a*d*c-u*l*m,this._z=a*l*m-u*d*c,this._w=a*l*c+u*d*m;break;case"ZXY":this._x=u*l*c-a*d*m,this._y=a*d*c+u*l*m,this._z=a*l*m+u*d*c,this._w=a*l*c-u*d*m;break;case"ZYX":this._x=u*l*c-a*d*m,this._y=a*d*c+u*l*m,this._z=a*l*m-u*d*c,this._w=a*l*c+u*d*m;break;case"YZX":this._x=u*l*c+a*d*m,this._y=a*d*c+u*l*m,this._z=a*l*m-u*d*c,this._w=a*l*c-u*d*m;break;case"XZY":this._x=u*l*c-a*d*m,this._y=a*d*c-u*l*m,this._z=a*l*m+u*d*c,this._w=a*l*c+u*d*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+h)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,s=Math.sin(i);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],s=e[4],r=e[8],h=e[1],n=e[5],o=e[9],a=e[2],l=e[6],c=e[10],u=i+n+c;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(l-o)*t,this._y=(r-a)*t,this._z=(h-s)*t}else if(i>n&&i>c){const t=2*Math.sqrt(1+i-n-c);this._w=(l-o)/t,this._x=.25*t,this._y=(s+h)/t,this._z=(r+a)/t}else if(n>c){const t=2*Math.sqrt(1+n-i-c);this._w=(r-a)/t,this._x=(s+h)/t,this._y=.25*t,this._z=(o+l)/t}else{const t=2*Math.sqrt(1+c-i-n);this._w=(h-s)/t,this._x=(r+a)/t,this._y=(o+l)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(P(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const s=Math.min(1,e/i);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,s=t._y,r=t._z,h=t._w,n=e._x,o=e._y,a=e._z,l=e._w;return this._x=i*l+h*n+s*a-r*o,this._y=s*l+h*o+r*n-i*a,this._z=r*l+h*a+i*o-s*n,this._w=h*l-i*n-s*o-r*a,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,s=this._y,r=this._z,h=this._w;let n=h*t._w+i*t._x+s*t._y+r*t._z;if(n<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,n=-n):this.copy(t),n>=1)return this._w=h,this._x=i,this._y=s,this._z=r,this;const o=1-n*n;if(o<=Number.EPSILON){const t=1-e;return this._w=t*h+e*this._w,this._x=t*i+e*this._x,this._y=t*s+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const a=Math.sqrt(o),l=Math.atan2(a,n),c=Math.sin((1-e)*l)/a,u=Math.sin(e*l)/a;return this._w=h*c+this._w*u,this._x=i*c+this._x*u,this._y=s*c+this._y*u,this._z=r*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),s=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(s),i*Math.sin(r),i*Math.cos(r),e*Math.sin(s))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class F{constructor(t=0,e=0,i=0){F.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(W.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(W.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*s,this.y=r[1]*e+r[4]*i+r[7]*s,this.z=r[2]*e+r[5]*i+r[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,r=t.elements,h=1/(r[3]*e+r[7]*i+r[11]*s+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*s+r[12])*h,this.y=(r[1]*e+r[5]*i+r[9]*s+r[13])*h,this.z=(r[2]*e+r[6]*i+r[10]*s+r[14])*h,this}applyQuaternion(t){const e=this.x,i=this.y,s=this.z,r=t.x,h=t.y,n=t.z,o=t.w,a=o*e+h*s-n*i,l=o*i+n*e-r*s,c=o*s+r*i-h*e,u=-r*e-h*i-n*s;return this.x=a*o+u*-r+l*-n-c*-h,this.y=l*o+u*-h+c*-r-a*-n,this.z=c*o+u*-n+a*-h-l*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,s=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*s,this.y=r[1]*e+r[5]*i+r[9]*s,this.z=r[2]*e+r[6]*i+r[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,s=t.y,r=t.z,h=e.x,n=e.y,o=e.z;return this.x=s*o-r*n,this.y=r*h-i*o,this.z=i*n-s*h,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return I.copy(this).projectOnVector(t),this.sub(I)}reflect(t){return this.sub(I.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(P(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,s=this.z-t.z;return e*e+i*i+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const s=Math.sin(e)*t;return this.x=s*Math.sin(i),this.y=Math.cos(e)*t,this.z=s*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const I=new F,W=new j;class L{constructor(){L.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,e,i,s,r,h,n,o,a,l,c,u,d,m,p,g){const f=this.elements;return f[0]=t,f[4]=e,f[8]=i,f[12]=s,f[1]=r,f[5]=h,f[9]=n,f[13]=o,f[2]=a,f[6]=l,f[10]=c,f[14]=u,f[3]=d,f[7]=m,f[11]=p,f[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new L).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,s=1/B.setFromMatrixColumn(t,0).length(),r=1/B.setFromMatrixColumn(t,1).length(),h=1/B.setFromMatrixColumn(t,2).length();return e[0]=i[0]*s,e[1]=i[1]*s,e[2]=i[2]*s,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*h,e[9]=i[9]*h,e[10]=i[10]*h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,s=t.y,r=t.z,h=Math.cos(i),n=Math.sin(i),o=Math.cos(s),a=Math.sin(s),l=Math.cos(r),c=Math.sin(r);if("XYZ"===t.order){const t=h*l,i=h*c,s=n*l,r=n*c;e[0]=o*l,e[4]=-o*c,e[8]=a,e[1]=i+s*a,e[5]=t-r*a,e[9]=-n*o,e[2]=r-t*a,e[6]=s+i*a,e[10]=h*o}else if("YXZ"===t.order){const t=o*l,i=o*c,s=a*l,r=a*c;e[0]=t+r*n,e[4]=s*n-i,e[8]=h*a,e[1]=h*c,e[5]=h*l,e[9]=-n,e[2]=i*n-s,e[6]=r+t*n,e[10]=h*o}else if("ZXY"===t.order){const t=o*l,i=o*c,s=a*l,r=a*c;e[0]=t-r*n,e[4]=-h*c,e[8]=s+i*n,e[1]=i+s*n,e[5]=h*l,e[9]=r-t*n,e[2]=-h*a,e[6]=n,e[10]=h*o}else if("ZYX"===t.order){const t=h*l,i=h*c,s=n*l,r=n*c;e[0]=o*l,e[4]=s*a-i,e[8]=t*a+r,e[1]=o*c,e[5]=r*a+t,e[9]=i*a-s,e[2]=-a,e[6]=n*o,e[10]=h*o}else if("YZX"===t.order){const t=h*o,i=h*a,s=n*o,r=n*a;e[0]=o*l,e[4]=r-t*c,e[8]=s*c+i,e[1]=c,e[5]=h*l,e[9]=-n*l,e[2]=-a*l,e[6]=i*c+s,e[10]=t-r*c}else if("XZY"===t.order){const t=h*o,i=h*a,s=n*o,r=n*a;e[0]=o*l,e[4]=-c,e[8]=a*l,e[1]=t*c+r,e[5]=h*l,e[9]=i*c-s,e[2]=s*c-i,e[6]=n*l,e[10]=r*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(q,t,N)}lookAt(t,e,i){const s=this.elements;return Y.subVectors(t,e),0===Y.lengthSq()&&(Y.z=1),Y.normalize(),H.crossVectors(i,Y),0===H.lengthSq()&&(1===Math.abs(i.z)?Y.x+=1e-4:Y.z+=1e-4,Y.normalize(),H.crossVectors(i,Y)),H.normalize(),U.crossVectors(Y,H),s[0]=H.x,s[4]=U.x,s[8]=Y.x,s[1]=H.y,s[5]=U.y,s[9]=Y.y,s[2]=H.z,s[6]=U.z,s[10]=Y.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,r=this.elements,h=i[0],n=i[4],o=i[8],a=i[12],l=i[1],c=i[5],u=i[9],d=i[13],m=i[2],p=i[6],g=i[10],f=i[14],y=i[3],x=i[7],v=i[11],w=i[15],_=s[0],M=s[4],C=s[8],b=s[12],E=s[1],S=s[5],O=s[9],k=s[13],z=s[2],D=s[6],A=s[10],R=s[14],P=s[3],T=s[7],j=s[11],F=s[15];return r[0]=h*_+n*E+o*z+a*P,r[4]=h*M+n*S+o*D+a*T,r[8]=h*C+n*O+o*A+a*j,r[12]=h*b+n*k+o*R+a*F,r[1]=l*_+c*E+u*z+d*P,r[5]=l*M+c*S+u*D+d*T,r[9]=l*C+c*O+u*A+d*j,r[13]=l*b+c*k+u*R+d*F,r[2]=m*_+p*E+g*z+f*P,r[6]=m*M+p*S+g*D+f*T,r[10]=m*C+p*O+g*A+f*j,r[14]=m*b+p*k+g*R+f*F,r[3]=y*_+x*E+v*z+w*P,r[7]=y*M+x*S+v*D+w*T,r[11]=y*C+x*O+v*A+w*j,r[15]=y*b+x*k+v*R+w*F,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],s=t[8],r=t[12],h=t[1],n=t[5],o=t[9],a=t[13],l=t[2],c=t[6],u=t[10],d=t[14];return t[3]*(+r*o*c-s*a*c-r*n*u+i*a*u+s*n*d-i*o*d)+t[7]*(+e*o*d-e*a*u+r*h*u-s*h*d+s*a*l-r*o*l)+t[11]*(+e*a*c-e*n*d-r*h*c+i*h*d+r*n*l-i*a*l)+t[15]*(-s*n*l-e*o*c+e*n*u+s*h*c-i*h*u+i*o*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=e,s[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],h=t[4],n=t[5],o=t[6],a=t[7],l=t[8],c=t[9],u=t[10],d=t[11],m=t[12],p=t[13],g=t[14],f=t[15],y=c*g*a-p*u*a+p*o*d-n*g*d-c*o*f+n*u*f,x=m*u*a-l*g*a-m*o*d+h*g*d+l*o*f-h*u*f,v=l*p*a-m*c*a+m*n*d-h*p*d-l*n*f+h*c*f,w=m*c*o-l*p*o-m*n*u+h*p*u+l*n*g-h*c*g,_=e*y+i*x+s*v+r*w;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const M=1/_;return t[0]=y*M,t[1]=(p*u*r-c*g*r-p*s*d+i*g*d+c*s*f-i*u*f)*M,t[2]=(n*g*r-p*o*r+p*s*a-i*g*a-n*s*f+i*o*f)*M,t[3]=(c*o*r-n*u*r-c*s*a+i*u*a+n*s*d-i*o*d)*M,t[4]=x*M,t[5]=(l*g*r-m*u*r+m*s*d-e*g*d-l*s*f+e*u*f)*M,t[6]=(m*o*r-h*g*r-m*s*a+e*g*a+h*s*f-e*o*f)*M,t[7]=(h*u*r-l*o*r+l*s*a-e*u*a-h*s*d+e*o*d)*M,t[8]=v*M,t[9]=(m*c*r-l*p*r-m*i*d+e*p*d+l*i*f-e*c*f)*M,t[10]=(h*p*r-m*n*r+m*i*a-e*p*a-h*i*f+e*n*f)*M,t[11]=(l*n*r-h*c*r-l*i*a+e*c*a+h*i*d-e*n*d)*M,t[12]=w*M,t[13]=(l*p*s-m*c*s+m*i*u-e*p*u-l*i*g+e*c*g)*M,t[14]=(m*n*s-h*p*s-m*i*o+e*p*o+h*i*g-e*n*g)*M,t[15]=(h*c*s-l*n*s+l*i*o-e*c*o-h*i*u+e*n*u)*M,this}scale(t){const e=this.elements,i=t.x,s=t.y,r=t.z;return e[0]*=i,e[4]*=s,e[8]*=r,e[1]*=i,e[5]*=s,e[9]*=r,e[2]*=i,e[6]*=s,e[10]*=r,e[3]*=i,e[7]*=s,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,s))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),s=Math.sin(e),r=1-i,h=t.x,n=t.y,o=t.z,a=r*h,l=r*n;return this.set(a*h+i,a*n-s*o,a*o+s*n,0,a*n+s*o,l*n+i,l*o-s*h,0,a*o-s*n,l*o+s*h,r*o*o+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,s,r,h){return this.set(1,i,r,0,t,1,h,0,e,s,1,0,0,0,0,1),this}compose(t,e,i){const s=this.elements,r=e._x,h=e._y,n=e._z,o=e._w,a=r+r,l=h+h,c=n+n,u=r*a,d=r*l,m=r*c,p=h*l,g=h*c,f=n*c,y=o*a,x=o*l,v=o*c,w=i.x,_=i.y,M=i.z;return s[0]=(1-(p+f))*w,s[1]=(d+v)*w,s[2]=(m-x)*w,s[3]=0,s[4]=(d-v)*_,s[5]=(1-(u+f))*_,s[6]=(g+y)*_,s[7]=0,s[8]=(m+x)*M,s[9]=(g-y)*M,s[10]=(1-(u+p))*M,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,e,i){const s=this.elements;let r=B.set(s[0],s[1],s[2]).length();const h=B.set(s[4],s[5],s[6]).length(),n=B.set(s[8],s[9],s[10]).length();this.determinant()<0&&(r=-r),t.x=s[12],t.y=s[13],t.z=s[14],G.copy(this);const o=1/r,a=1/h,l=1/n;return G.elements[0]*=o,G.elements[1]*=o,G.elements[2]*=o,G.elements[4]*=a,G.elements[5]*=a,G.elements[6]*=a,G.elements[8]*=l,G.elements[9]*=l,G.elements[10]*=l,e.setFromRotationMatrix(G),i.x=r,i.y=h,i.z=n,this}makePerspective(t,e,i,s,r,h){const n=this.elements,o=2*r/(e-t),a=2*r/(i-s),l=(e+t)/(e-t),c=(i+s)/(i-s),u=-(h+r)/(h-r),d=-2*h*r/(h-r);return n[0]=o,n[4]=0,n[8]=l,n[12]=0,n[1]=0,n[5]=a,n[9]=c,n[13]=0,n[2]=0,n[6]=0,n[10]=u,n[14]=d,n[3]=0,n[7]=0,n[11]=-1,n[15]=0,this}makeOrthographic(t,e,i,s,r,h){const n=this.elements,o=1/(e-t),a=1/(i-s),l=1/(h-r),c=(e+t)*o,u=(i+s)*a,d=(h+r)*l;return n[0]=2*o,n[4]=0,n[8]=0,n[12]=-c,n[1]=0,n[5]=2*a,n[9]=0,n[13]=-u,n[2]=0,n[6]=0,n[10]=-2*l,n[14]=-d,n[3]=0,n[7]=0,n[11]=0,n[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const B=new F,G=new L,q=new F(0,0,0),N=new F(1,1,1),H=new F,U=new F,Y=new F,X=new L,V=new j;class Q{constructor(t=0,e=0,i=0,s=Q.DefaultOrder){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,s=this._order){return this._x=t,this._y=e,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const s=t.elements,r=s[0],h=s[4],n=s[8],o=s[1],a=s[5],l=s[9],c=s[2],u=s[6],d=s[10];switch(e){case"XYZ":this._y=Math.asin(P(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-h,r)):(this._x=Math.atan2(u,a),this._z=0);break;case"YXZ":this._x=Math.asin(-P(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(n,d),this._z=Math.atan2(o,a)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin(P(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-h,a)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-P(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-h,a));break;case"YZX":this._z=Math.asin(P(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,a),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(n,d));break;case"XZY":this._z=Math.asin(-P(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,a),this._y=Math.atan2(n,r)):(this._x=Math.atan2(-l,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return X.makeRotationFromQuaternion(t),this.setFromRotationMatrix(X,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return V.setFromEuler(this),this.setFromQuaternion(V,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}Q.DefaultOrder="XYZ",Q.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class K{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}class Z{constructor(){Z.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(t,e,i,s,r,h,n,o,a){const l=this.elements;return l[0]=t,l[1]=s,l[2]=n,l[3]=e,l[4]=r,l[5]=o,l[6]=i,l[7]=h,l[8]=a,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,r=this.elements,h=i[0],n=i[3],o=i[6],a=i[1],l=i[4],c=i[7],u=i[2],d=i[5],m=i[8],p=s[0],g=s[3],f=s[6],y=s[1],x=s[4],v=s[7],w=s[2],_=s[5],M=s[8];return r[0]=h*p+n*y+o*w,r[3]=h*g+n*x+o*_,r[6]=h*f+n*v+o*M,r[1]=a*p+l*y+c*w,r[4]=a*g+l*x+c*_,r[7]=a*f+l*v+c*M,r[2]=u*p+d*y+m*w,r[5]=u*g+d*x+m*_,r[8]=u*f+d*v+m*M,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],h=t[4],n=t[5],o=t[6],a=t[7],l=t[8];return e*h*l-e*n*a-i*r*l+i*n*o+s*r*a-s*h*o}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],r=t[3],h=t[4],n=t[5],o=t[6],a=t[7],l=t[8],c=l*h-n*a,u=n*o-l*r,d=a*r-h*o,m=e*c+i*u+s*d;if(0===m)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return t[0]=c*p,t[1]=(s*a-l*i)*p,t[2]=(n*i-s*h)*p,t[3]=u*p,t[4]=(l*e-s*o)*p,t[5]=(s*r-n*e)*p,t[6]=d*p,t[7]=(i*o-a*e)*p,t[8]=(h*e-i*r)*p,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,s,r,h,n){const o=Math.cos(r),a=Math.sin(r);return this.set(i*o,i*a,-i*(o*h+a*n)+h+t,-s*a,s*o,-s*(-a*h+o*n)+n+e,0,0,1),this}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),s=this.elements,r=s[0],h=s[3],n=s[6],o=s[1],a=s[4],l=s[7];return s[0]=e*r+i*o,s[3]=e*h+i*a,s[6]=e*n+i*l,s[1]=-i*r+e*o,s[4]=-i*h+e*a,s[7]=-i*n+e*l,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}let J=0;const $=new F,tt=new j,et=new L,it=new F,st=new F,rt=new F,ht=new j,nt=new F(1,0,0),ot=new F(0,1,0),at=new F(0,0,1),lt={type:"added"},ct={type:"removed"};class ut extends class{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,s=i.length;e<s;e++)i[e].call(this,t);t.target=null}}}{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:J++}),this.uuid=function(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,s=4294967295*Math.random()|0;return(D[255&t]+D[t>>8&255]+D[t>>16&255]+D[t>>24&255]+"-"+D[255&e]+D[e>>8&255]+"-"+D[e>>16&15|64]+D[e>>24&255]+"-"+D[63&i|128]+D[i>>8&255]+"-"+D[i>>16&255]+D[i>>24&255]+D[255&s]+D[s>>8&255]+D[s>>16&255]+D[s>>24&255]).toLowerCase()}(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ut.DefaultUp.clone();const t=new F,e=new Q,i=new j,s=new F(1,1,1);e._onChange((function(){i.setFromEuler(e,!1)})),i._onChange((function(){e.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new L},normalMatrix:{value:new Z}}),this.matrix=new L,this.matrixWorld=new L,this.matrixAutoUpdate=ut.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=ut.DefaultMatrixWorldAutoUpdate,this.layers=new K,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return tt.setFromAxisAngle(t,e),this.quaternion.multiply(tt),this}rotateOnWorldAxis(t,e){return tt.setFromAxisAngle(t,e),this.quaternion.premultiply(tt),this}rotateX(t){return this.rotateOnAxis(nt,t)}rotateY(t){return this.rotateOnAxis(ot,t)}rotateZ(t){return this.rotateOnAxis(at,t)}translateOnAxis(t,e){return $.copy(t).applyQuaternion(this.quaternion),this.position.add($.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(nt,t)}translateY(t){return this.translateOnAxis(ot,t)}translateZ(t){return this.translateOnAxis(at,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(et.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?it.copy(t):it.set(t,e,i);const s=this.parent;this.updateWorldMatrix(!0,!1),st.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?et.lookAt(st,it,this.up):et.lookAt(it,st,this.up),this.quaternion.setFromRotationMatrix(et),s&&(et.extractRotation(s.matrixWorld),tt.setFromRotationMatrix(et),this.quaternion.premultiply(tt.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(lt)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(ct)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(ct)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),et.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),et.multiply(t.parent.matrixWorld)),t.applyMatrix4(et),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,s=this.children.length;i<s;i++){const s=this.children[i].getObjectByProperty(t,e);if(void 0!==s)return s}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(st,t,rt),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(st,ht,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,s=e.length;i<s;i++){const s=e[i];!0!==s.matrixWorldAutoUpdate&&!0!==t||s.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const s={};function r(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),!0===this.castShadow&&(s.castShadow=!0),!0===this.receiveShadow&&(s.receiveShadow=!0),!1===this.visible&&(s.visible=!1),!1===this.frustumCulled&&(s.frustumCulled=!1),0!==this.renderOrder&&(s.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(s.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,s=i.length;e<s;e++){const s=i[e];r(t.shapes,s)}else r(t.shapes,i)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,s=this.material.length;i<s;i++)e.push(r(t.materials,this.material[i]));s.material=e}else s.material=r(t.materials,this.material);if(this.children.length>0){s.children=[];for(let e=0;e<this.children.length;e++)s.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];s.animations.push(r(t.animations,i))}}if(e){const e=h(t.geometries),s=h(t.materials),r=h(t.textures),n=h(t.images),o=h(t.shapes),a=h(t.skeletons),l=h(t.animations),c=h(t.nodes);e.length>0&&(i.geometries=e),s.length>0&&(i.materials=s),r.length>0&&(i.textures=r),n.length>0&&(i.images=n),o.length>0&&(i.shapes=o),a.length>0&&(i.skeletons=a),l.length>0&&(i.animations=l),c.length>0&&(i.nodes=c)}return i.object=s,i;function h(t){const e=[];for(const i in t){const s=t[i];delete s.metadata,e.push(s)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}}ut.DefaultUp=new F(0,1,0),ut.DefaultMatrixAutoUpdate=!0,ut.DefaultMatrixWorldAutoUpdate=!0;class dt extends ut{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(t){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=t}}class mt{constructor(t=0,e=0,i=0,s=mt.DefaultOrder){this.isEuler=!0,this.th=t,this.sh=e,this.hh=i,this.ih=s,this._onChangeCallback=()=>{},this.eh=()=>{},this.rh=()=>{}}onBeforeGetComponent(t){this.rh=t}onBeforeChange(t){this.eh=t}get _x(){return this.rh(),this.th}set _x(t){this.th=t}get _y(){return this.rh(),this.sh}set _y(t){this.sh=t}get _z(){return this.rh(),this.hh}set _z(t){this.hh=t}get _order(){return this.rh(),this.ih}set _order(t){this.ih=t}get x(){return this.rh(),this.th}set x(t){this.eh(),this.th=t,this._onChangeCallback()}get y(){return this.rh(),this.sh}set y(t){this.eh(),this.sh=t,this._onChangeCallback()}get z(){return this.rh(),this.hh}set z(t){this.eh(),this.hh=t,this._onChangeCallback()}get order(){return this.rh(),this.ih}set order(t){this.eh(),this.ih=t,this._onChangeCallback()}set(t,e,i,s){return this.eh(),this.th=t,this.sh=e,this.hh=i,s&&(this.ih=s),this._onChangeCallback(),this}clone(){return this.rh(),new Q(this.th,this.sh,this.hh,this.ih)}copy(t){return this.eh(),this.th=t._x,this.sh=t._y,this.hh=t._z,this.ih=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e,i=!0){this.rh();const s=t.elements,r=s[0],h=s[4],n=s[8],o=s[1],a=s[5],l=s[9],c=s[2],u=s[6],d=s[10];switch(e||(e=this.ih),this.eh(),e){case"XYZ":this.sh=Math.asin(P(n,-1,1)),Math.abs(n)<.9999999?(this.th=Math.atan2(-l,d),this.hh=Math.atan2(-h,r)):(this.th=Math.atan2(u,a),this.hh=0);break;case"YXZ":this.th=Math.asin(-P(l,-1,1)),Math.abs(l)<.9999999?(this.sh=Math.atan2(n,d),this.hh=Math.atan2(o,a)):(this.sh=Math.atan2(-c,r),this.hh=0);break;case"ZXY":this.th=Math.asin(P(u,-1,1)),Math.abs(u)<.9999999?(this.sh=Math.atan2(-c,d),this.hh=Math.atan2(-h,a)):(this.sh=0,this.hh=Math.atan2(o,r));break;case"ZYX":this.sh=Math.asin(-P(c,-1,1)),Math.abs(c)<.9999999?(this.th=Math.atan2(u,d),this.hh=Math.atan2(o,r)):(this.th=0,this.hh=Math.atan2(-h,a));break;case"YZX":this.hh=Math.asin(P(o,-1,1)),Math.abs(o)<.9999999?(this.th=Math.atan2(-l,a),this.sh=Math.atan2(-c,r)):(this.th=0,this.sh=Math.atan2(n,d));break;case"XZY":this.hh=Math.asin(-P(h,-1,1)),Math.abs(h)<.9999999?(this.th=Math.atan2(u,a),this.sh=Math.atan2(n,r)):(this.th=Math.atan2(-l,d),this.sh=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this.ih=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return pt.makeRotationFromQuaternion(t),this.setFromRotationMatrix(pt,e,i)}setFromVector3(t,e){return this.set(t.x,t.y,t.z,e)}reorder(t){return gt.setFromEuler(this),this.setFromQuaternion(gt,t)}equals(t){return this.rh(),t._x===this.th&&t._y===this.sh&&t._z===this.hh&&t._order===this.ih}fromArray(t){return this.th===t[0]&&this.sh===t[1]&&this.hh===t[2]&&this.ih===t[3]||(this.eh(),this.th=t[0],this.sh=t[1],this.hh=t[2],void 0!==t[3]&&(this.ih=t[3]),this._onChangeCallback()),this}toArray(t=[],e=0){return this.rh(),t[e]=this.th,t[e+1]=this.sh,t[e+2]=this.hh,t[e+3]=this.ih,t}_onChange(t){return this._onChangeCallback=t,this}*[Symbol.iterator](){this.rh(),yield this.th,this.rh(),yield this.sh,this.rh(),yield this.hh,this.rh(),yield this.ih}}mt.DefaultOrder="XYZ",mt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const pt=new L,gt=new j;class ft{constructor(t=0,e=0,i=0,s=1){this.isQuaternion=!0,this.th=t,this.sh=e,this.hh=i,this.hi=s,this._onChangeCallback=()=>{},this.eh=()=>{},this.rh=()=>{}}onBeforeGetComponent(t){this.rh=t}onBeforeChange(t){this.eh=t}static slerp(t,e,i,s){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(t,e,s)}static slerpFlat(t,e,i,s,r,h,n){let o=i[s+0],a=i[s+1],l=i[s+2],c=i[s+3];const u=r[h+0],d=r[h+1],m=r[h+2],p=r[h+3];if(0===n)return t[e+0]=o,t[e+1]=a,t[e+2]=l,void(t[e+3]=c);if(1===n)return t[e+0]=u,t[e+1]=d,t[e+2]=m,void(t[e+3]=p);if(c!==p||o!==u||a!==d||l!==m){let t=1-n;const e=o*u+a*d+l*m+c*p,i=e>=0?1:-1,s=1-e*e;if(s>Number.EPSILON){const r=Math.sqrt(s),h=Math.atan2(r,e*i);t=Math.sin(t*h)/r,n=Math.sin(n*h)/r}const r=n*i;if(o=o*t+u*r,a=a*t+d*r,l=l*t+m*r,c=c*t+p*r,t===1-n){const t=1/Math.sqrt(o*o+a*a+l*l+c*c);o*=t,a*=t,l*=t,c*=t}}t[e]=o,t[e+1]=a,t[e+2]=l,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,s,r,h){const n=i[s],o=i[s+1],a=i[s+2],l=i[s+3],c=r[h],u=r[h+1],d=r[h+2],m=r[h+3];return t[e]=n*m+l*c+o*d-a*u,t[e+1]=o*m+l*u+a*c-n*d,t[e+2]=a*m+l*d+n*u-o*c,t[e+3]=l*m-n*c-o*u-a*d,t}get _x(){return this.rh(),this.th}set _x(t){this.th=t}get _y(){return this.rh(),this.sh}set _y(t){this.sh=t}get _z(){return this.rh(),this.hh}set _z(t){this.hh=t}get _w(){return this.rh(),this.hi}set _w(t){this.hi=t}get x(){return this.rh(),this.th}set x(t){this.eh(),this.th=t,this._onChangeCallback()}get y(){return this.rh(),this.sh}set y(t){this.eh(),this.sh=t,this._onChangeCallback()}get z(){return this.rh(),this.hh}set z(t){this.eh(),this.hh=t,this._onChangeCallback()}get w(){return this.rh(),this.hi}set w(t){this.eh(),this.hi=t,this._onChangeCallback()}set(t,e,i,s){return this.eh(),this.th=t,this.sh=e,this.hh=i,this.hi=s,this._onChangeCallback(),this}clone(){return this.rh(),new j(this.th,this.sh,this.hh,this.hi)}copy(t){return this.eh(),this.th=t.x,this.sh=t.y,this.hh=t.z,this.hi=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,s=t._y,r=t._z,h=t._order,n=Math.cos,o=Math.sin,a=n(i/2),l=n(s/2),c=n(r/2),u=o(i/2),d=o(s/2),m=o(r/2);switch(this.eh(),h){case"XYZ":this.th=u*l*c+a*d*m,this.sh=a*d*c-u*l*m,this.hh=a*l*m+u*d*c,this.hi=a*l*c-u*d*m;break;case"YXZ":this.th=u*l*c+a*d*m,this.sh=a*d*c-u*l*m,this.hh=a*l*m-u*d*c,this.hi=a*l*c+u*d*m;break;case"ZXY":this.th=u*l*c-a*d*m,this.sh=a*d*c+u*l*m,this.hh=a*l*m+u*d*c,this.hi=a*l*c-u*d*m;break;case"ZYX":this.th=u*l*c-a*d*m,this.sh=a*d*c+u*l*m,this.hh=a*l*m-u*d*c,this.hi=a*l*c+u*d*m;break;case"YZX":this.th=u*l*c+a*d*m,this.sh=a*d*c+u*l*m,this.hh=a*l*m-u*d*c,this.hi=a*l*c-u*d*m;break;case"XZY":this.th=u*l*c-a*d*m,this.sh=a*d*c-u*l*m,this.hh=a*l*m+u*d*c,this.hi=a*l*c+u*d*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+h)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,s=Math.sin(i);return this.eh(),this.th=t.x*s,this.sh=t.y*s,this.hh=t.z*s,this.hi=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],s=e[4],r=e[8],h=e[1],n=e[5],o=e[9],a=e[2],l=e[6],c=e[10],u=i+n+c;if(this.eh(),u>0){const t=.5/Math.sqrt(u+1);this.hi=.25/t,this.th=(l-o)*t,this.sh=(r-a)*t,this.hh=(h-s)*t}else if(i>n&&i>c){const t=2*Math.sqrt(1+i-n-c);this.hi=(l-o)/t,this.th=.25*t,this.sh=(s+h)/t,this.hh=(r+a)/t}else if(n>c){const t=2*Math.sqrt(1+n-i-c);this.hi=(r-a)/t,this.th=(s+h)/t,this.sh=.25*t,this.hh=(o+l)/t}else{const t=2*Math.sqrt(1+c-i-n);this.hi=(h-s)/t,this.th=(r+a)/t,this.sh=(o+l)/t,this.hh=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return this.eh(),i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this.th=-t.y,this.sh=t.x,this.hh=0,this.hi=i):(this.th=0,this.sh=-t.z,this.hh=t.y,this.hi=i)):(this.th=t.y*e.z-t.z*e.y,this.sh=t.z*e.x-t.x*e.z,this.hh=t.x*e.y-t.y*e.x,this.hi=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(P(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const s=Math.min(1,e/i);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this.rh(),this.eh(),this.th*=-1,this.sh*=-1,this.hh*=-1,this._onChangeCallback(),this}dot(t){return this.rh(),this.th*t._x+this.sh*t._y+this.hh*t._z+this.hi*t._w}lengthSq(){return this.rh(),this.th*this.th+this.sh*this.sh+this.hh*this.hh+this.hi*this.hi}length(){return this.rh(),Math.sqrt(this.th*this.th+this.sh*this.sh+this.hh*this.hh+this.hi*this.hi)}normalize(){let t=this.length();return 0===t?(this.eh(),this.th=0,this.sh=0,this.hh=0,this.hi=1):(t=1/t,this.rh(),this.eh(),this.th=this.th*t,this.sh=this.sh*t,this.hh=this.hh*t,this.hi=this.hi*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):0===t._x&&0===t._y&&0===t._z&&1===t._w?this:this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,s=t._y,r=t._z,h=t._w,n=e._x,o=e._y,a=e._z,l=e._w;return this.eh(),this.th=i*l+h*n+s*a-r*o,this.sh=s*l+h*o+r*n-i*a,this.hh=r*l+h*a+i*o-s*n,this.hi=h*l-i*n-s*o-r*a,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);this.rh();const i=this.th,s=this.sh,r=this.hh,h=this.hi;let n=h*t._w+i*t._x+s*t._y+r*t._z;if(this.eh(),n<0?(this.hi=-t._w,this.th=-t._x,this.sh=-t._y,this.hh=-t._z,n=-n):this.copy(t),n>=1)return this.hi=h,this.th=i,this.sh=s,this.hh=r,this;const o=1-n*n;if(o<=Number.EPSILON){const t=1-e;return this.hi=t*h+e*this.hi,this.th=t*i+e*this.th,this.sh=t*s+e*this.sh,this.hh=t*r+e*this.hh,this.normalize(),this}const a=Math.sqrt(o),l=Math.atan2(a,n),c=Math.sin((1-e)*l)/a,u=Math.sin(e*l)/a;return this.hi=h*c+this.hi*u,this.th=i*c+this.th*u,this.sh=s*c+this.sh*u,this.hh=r*c+this.hh*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),s=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(s),i*Math.sin(r),i*Math.cos(r),e*Math.sin(s))}equals(t){return this.rh(),t._x===this.th&&t._y===this.sh&&t._z===this.hh&&t._w===this.hi}fromArray(t,e=0){return this.th===t[e]&&this.sh===t[e+1]&&this.hh===t[e+2]&&this.hi===t[e+3]||(this.eh(),this.th=t[e],this.sh=t[e+1],this.hh=t[e+2],this.hi=t[e+3],this._onChangeCallback()),this}toArray(t=[],e=0){return this.rh(),t[e]=this.th,t[e+1]=this.sh,t[e+2]=this.hh,t[e+3]=this.hi,t}fromBufferAttribute(t,e){return this.th=t.getX(e),this.sh=t.getY(e),this.hh=t.getZ(e),this.hi=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}*[Symbol.iterator](){this.rh(),yield this.th,this.rh(),yield this.sh,this.rh(),yield this.hh,this.rh(),yield this.hi}}class yt{constructor(t=0,e=0,i=0){this.isVector3=!0,this.nh=t,this.ah=e,this.oh=i,this.eh=()=>{},this.rh=()=>{}}onBeforeChange(t){this.eh=t}onBeforeGetComponent(t){this.rh=t}get x(){return this.rh(),this.nh}set x(t){this.eh(),this.nh=t}get y(){return this.rh(),this.ah}set y(t){this.eh(),this.ah=t}get z(){return this.rh(),this.oh}set z(t){this.eh(),this.oh=t}set(t,e,i){return void 0===i&&(this.rh(),i=this.oh),this.eh(),this.nh=t,this.ah=e,this.oh=i,this}setScalar(t){return this.eh(),this.nh=t,this.ah=t,this.oh=t,this}setX(t){return this.eh(),this.nh=t,this}setY(t){return this.eh(),this.ah=t,this}setZ(t){return this.eh(),this.oh=t,this}setComponent(t,e){switch(t){case 0:this.eh(),this.nh=e;break;case 1:this.eh(),this.ah=e;break;case 2:this.eh(),this.oh=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(this.rh(),t){case 0:return this.nh;case 1:return this.ah;case 2:return this.oh;default:throw new Error("index is out of range: "+t)}}clone(){return this.rh(),new F(this.nh,this.ah,this.oh)}copy(t){return this.eh(),this.nh=t.x,this.ah=t.y,this.oh=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(0===t.x&&0===t.y&&0===t.z||(this.rh(),this.eh(),this.nh+=t.x,this.ah+=t.y,this.oh+=t.z),this)}addScalar(t){return 0===t||(this.rh(),this.eh(),this.nh+=t,this.ah+=t,this.oh+=t),this}addVectors(t,e){return this.eh(),this.nh=t.x+e.x,this.ah=t.y+e.y,this.oh=t.z+e.z,this}addScaledVector(t,e){return this.rh(),this.eh(),this.nh+=t.x*e,this.ah+=t.y*e,this.oh+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(0===t.x&&0===t.y&&0===t.z||(this.rh(),this.eh(),this.nh-=t.x,this.ah-=t.y,this.oh-=t.z),this)}subScalar(t){return 0===t||(this.rh(),this.eh(),this.nh-=t,this.ah-=t,this.oh-=t),this}subVectors(t,e){return this.eh(),this.nh=t.x-e.x,this.ah=t.y-e.y,this.oh=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(1===t.x&&1===t.y&&1===t.z||(this.rh(),this.eh(),this.nh*=t.x,this.ah*=t.y,this.oh*=t.z),this)}multiplyScalar(t){return 1===t||(this.rh(),this.eh(),this.nh*=t,this.ah*=t,this.oh*=t),this}multiplyVectors(t,e){return this.eh(),this.nh=t.x*e.x,this.ah=t.y*e.y,this.oh=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(vt.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(vt.setFromAxisAngle(t,e))}applyMatrix3(t){this.rh();const e=this.nh,i=this.ah,s=this.oh,r=t.elements;return this.eh(),this.nh=r[0]*e+r[3]*i+r[6]*s,this.ah=r[1]*e+r[4]*i+r[7]*s,this.oh=r[2]*e+r[5]*i+r[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){this.rh();const e=this.nh,i=this.ah,s=this.oh,r=t.elements,h=1/(r[3]*e+r[7]*i+r[11]*s+r[15]);return this.eh(),this.nh=(r[0]*e+r[4]*i+r[8]*s+r[12])*h,this.ah=(r[1]*e+r[5]*i+r[9]*s+r[13])*h,this.oh=(r[2]*e+r[6]*i+r[10]*s+r[14])*h,this}applyQuaternion(t){this.rh();const e=this.nh,i=this.ah,s=this.oh,r=t.x,h=t.y,n=t.z,o=t.w,a=o*e+h*s-n*i,l=o*i+n*e-r*s,c=o*s+r*i-h*e,u=-r*e-h*i-n*s;return this.eh(),this.nh=a*o+u*-r+l*-n-c*-h,this.ah=l*o+u*-h+c*-r-a*-n,this.oh=c*o+u*-n+a*-h-l*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){this.rh();const e=this.nh,i=this.ah,s=this.oh,r=t.elements;return this.eh(),this.nh=r[0]*e+r[4]*i+r[8]*s,this.ah=r[1]*e+r[5]*i+r[9]*s,this.oh=r[2]*e+r[6]*i+r[10]*s,this.normalize()}divide(t){return 1===t.x&&1===t.y&&1===t.z||(this.rh(),this.eh(),this.nh/=t.x,this.ah/=t.y,this.oh/=t.z),this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.rh(),this.eh(),this.nh=Math.min(this.nh,t.x),this.ah=Math.min(this.ah,t.y),this.oh=Math.min(this.oh,t.z),this}max(t){return this.rh(),this.eh(),this.nh=Math.max(this.nh,t.x),this.ah=Math.max(this.ah,t.y),this.oh=Math.max(this.oh,t.z),this}clamp(t,e){return this.rh(),this.eh(),this.nh=Math.max(t.x,Math.min(e.x,this.nh)),this.ah=Math.max(t.y,Math.min(e.y,this.ah)),this.oh=Math.max(t.z,Math.min(e.z,this.oh)),this}clampScalar(t,e){return this.rh(),this.eh(),this.nh=Math.max(t,Math.min(e,this.nh)),this.ah=Math.max(t,Math.min(e,this.ah)),this.oh=Math.max(t,Math.min(e,this.oh)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.rh(),this.eh(),this.nh=Math.floor(this.nh),this.ah=Math.floor(this.ah),this.oh=Math.floor(this.oh),this}ceil(){return this.rh(),this.eh(),this.nh=Math.ceil(this.nh),this.ah=Math.ceil(this.ah),this.oh=Math.ceil(this.oh),this}round(){return this.rh(),this.eh(),this.nh=Math.round(this.nh),this.ah=Math.round(this.ah),this.oh=Math.round(this.oh),this}roundToZero(){return this.rh(),this.eh(),this.nh=this.nh<0?Math.ceil(this.nh):Math.floor(this.nh),this.ah=this.ah<0?Math.ceil(this.ah):Math.floor(this.ah),this.oh=this.oh<0?Math.ceil(this.oh):Math.floor(this.oh),this}negate(){return this.rh(),this.eh(),this.nh=-this.nh,this.ah=-this.ah,this.oh=-this.oh,this}dot(t){return this.rh(),this.nh*t.x+this.ah*t.y+this.oh*t.z}lengthSq(){return this.rh(),this.nh*this.nh+this.ah*this.ah+this.oh*this.oh}length(){return this.rh(),Math.sqrt(this.nh*this.nh+this.ah*this.ah+this.oh*this.oh)}manhattanLength(){return this.rh(),Math.abs(this.nh)+Math.abs(this.ah)+Math.abs(this.oh)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.rh(),this.eh(),this.nh+=(t.x-this.nh)*e,this.ah+=(t.y-this.ah)*e,this.oh+=(t.z-this.oh)*e,this}lerpVectors(t,e,i){return this.eh(),this.nh=t.x+(e.x-t.x)*i,this.ah=t.y+(e.y-t.y)*i,this.oh=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,s=t.y,r=t.z,h=e.x,n=e.y,o=e.z;return this.eh(),this.nh=s*o-r*n,this.ah=r*h-i*o,this.oh=i*n-s*h,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return xt.copy(this).projectOnVector(t),this.sub(xt)}reflect(t){return this.sub(xt.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(P(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){this.rh();const e=this.nh-t.x,i=this.ah-t.y,s=this.oh-t.z;return e*e+i*i+s*s}manhattanDistanceTo(t){return this.rh(),Math.abs(this.nh-t.x)+Math.abs(this.ah-t.y)+Math.abs(this.oh-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const s=Math.sin(e)*t;return this.eh(),this.nh=s*Math.sin(i),this.ah=Math.cos(e)*t,this.oh=s*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.eh(),this.nh=t*Math.sin(e),this.ah=i,this.oh=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.eh(),this.nh=e[12],this.ah=e[13],this.oh=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.eh(),this.nh=e,this.ah=i,this.oh=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return this.rh(),t.x===this.nh&&t.y===this.ah&&t.z===this.oh}fromArray(t,e=0){return this.nh===t[e]&&this.ah===t[e+1]&&this.oh===t[e+2]||(this.eh(),this.nh=t[e],this.ah=t[e+1],this.oh=t[e+2]),this}toArray(t=[],e=0){return this.rh(),t[e]=this.nh,t[e+1]=this.ah,t[e+2]=this.oh,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.eh(),this.nh=t.getX(e),this.ah=t.getY(e),this.oh=t.getZ(e),this}random(){return this.eh(),this.nh=Math.random(),this.ah=Math.random(),this.oh=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-Math.pow(t,2));return this.eh(),this.nh=i*Math.cos(e),this.ah=i*Math.sin(e),this.oh=t,this}*[Symbol.iterator](){this.rh(),yield this.nh,this.rh(),yield this.ah,this.rh(),yield this.oh}}const xt=new yt,vt=new j;class wt{constructor(t,e,i){this.ts=!1,this.ss=!1,this.es=!1,this.rs=!1,this.hs=!1,this.ns=this.os.bind(this),this.ls=this.fs.bind(this),this.cs=this.us.bind(this),this.ds=this.ps.bind(this),this.vs=this.bs.bind(this),this.Ts=this._s.bind(this),this.Os=this.gs.bind(this),this.Rs=this.xs.bind(this),this.ws=!1,this.isRegisteredToProcessor=!1,this.T=e,this.Ws=i,this.Ms=new wt._transformObject3D,this.Ms.matrixAutoUpdate=!0,this.Ms.userData=this,e.scene.unsafeGetThreeScene().add(this.Ms),Object.defineProperties(this.Ms,{position:{writable:!0},rotation:{writable:!0},quaternion:{writable:!0},scale:{writable:!0}});const s=this.ns,r=this.ls,h=new yt;h.onBeforeGetComponent(s),h.onBeforeChange(r),this.Ms.position=h;const n=new mt;n.onBeforeGetComponent(s),n.onBeforeChange(r),n._onChange(this.cs),this.Ms.rotation=n;const o=new ft;o.onBeforeGetComponent(s),o.onBeforeChange(r),o._onChange(this.ds),this.Ms.quaternion=o;const a=new yt(1,1,1);a.onBeforeGetComponent(s),a.onBeforeChange(r),this.Ms.scale=a,this.yt=t;const l=this.vs,c=this.Ts,u=new yt;u.onBeforeGetComponent(l),u.onBeforeChange(c),this.Cs=u;const d=new mt;d.onBeforeGetComponent(l),d.onBeforeChange(c),d._onChange(this.Os),this.ys=d;const m=new ft;m.onBeforeGetComponent(l),m.onBeforeChange(c),m._onChange(this.Rs),this.Fs=m;const p=new yt(1,1,1);p.onBeforeGetComponent(l),p.onBeforeChange(c),this.Vs=p,this.As()}os(){this.ws||this.Ls()}fs(){this.ws||(this.Ls(),this.Ps(),this.hs=!1,this.ss=!0,this.As(),this.Ss(),this.js())}us(){this.ws||this.Ms.quaternion.setFromEuler(this.Ms.rotation,!1)}ps(){this.ws||this.Ms.rotation.setFromQuaternion(this.Ms.quaternion,void 0,!1)}bs(){this.ws||this.Ds()}_s(){this.ws||(this.Ds(),this.Ps(),this.rs=!1,this.hs=!0,this.ss=!0,this.As(),this.Es(),this.js())}gs(){this.ws||this.Fs.setFromEuler(this.ys,!1)}xs(){this.ws||this.ys.setFromQuaternion(this.Fs,void 0,!1)}Ss(){this.rs=!0;const t=this.Ms.children;for(let e=0,i=t.length;e<i;++e){const i=t[e];i.userData instanceof wt&&i.userData.Ss()}}Es(){const t=this.Ms.children;for(let e=0,i=t.length;e<i;++e){const i=t[e];i.userData instanceof wt&&i.userData.Ss()}}As(){this.T.transformMatrixProcessor.enqueueTransformToUpdate(this),this.Us()}Us(){this.es=!0;const t=this.Ms.children;for(let e=0,i=t.length;e<i;++e){const i=t[e];i.userData instanceof wt&&i.userData.Us()}}js(){this.ts=!0;const t=this.Ms.children;for(let e=0,i=t.length;e<i;++e){const i=t[e];i.userData instanceof wt&&i.userData.js()}}Ls(){if(this.hs){if(this.ss){this.es&&(this.ws=!0,this.Ms.matrixWorld.compose(this.Cs,this.Fs,this.Vs),this.ws=!1,this.es=!1,this.yt.gameObjectEventContainer.invokeOnWorldMatrixUpdated());const t=this.parent;if(t){t.Qs();const e=wt._matrix4Buffer.copy(t.Ms.matrixWorld).invert();this.Ms.matrix.multiplyMatrices(this.Ms.matrixWorld,e)}else this.Ms.matrix.copy(this.Ms.matrixWorld);this.ss=!1}this.ws=!0,this.Ms.matrix.decompose(this.localPosition,this.localRotation,this.localScale),this.localEulerAngles.setFromQuaternion(this.localRotation,void 0,!1),this.ws=!1,this.hs=!1}}Ds(){this.rs&&(this.Qs(),this.ws=!0,this.Ms.matrixWorld.decompose(this.Cs,this.Fs,this.Vs),this.ys.setFromQuaternion(this.Fs,void 0,!1),this.ws=!1,this.rs=!1)}Qs(){if(!this.es)return;const t=this.Ms.matrix;if(this.ss)if(this.hs)this.ws=!0,this.Ms.matrixWorld.compose(this.Cs,this.Fs,this.Vs),this.ws=!1;else{this.ss&&(this.ws=!0,t.compose(this.localPosition,this.localRotation,this.localScale),this.ws=!1,this.ss=!1);const e=this.parent;e?(e.Qs(),this.Ms.matrixWorld.multiplyMatrices(e.Ms.matrixWorld,t)):this.Ms.matrixWorld.copy(t)}else{const e=this.parent;e?(e.Qs(),this.Ms.matrixWorld.multiplyMatrices(e.Ms.matrixWorld,t)):this.Ms.matrixWorld.copy(t)}this.es=!1,this.yt.gameObjectEventContainer.invokeOnWorldMatrixUpdated()}Ns(){if(!this.ss)return;const t=this.Ms.matrix;if(this.es)if(this.rs)this.ws=!0,t.compose(this.localPosition,this.localRotation,this.localScale),this.ws=!1;else{this.es&&(this.ws=!0,this.Ms.matrixWorld.compose(this.Cs,this.Fs,this.Vs),this.ws=!1,this.es=!1,this.yt.gameObjectEventContainer.invokeOnWorldMatrixUpdated());const t=this.parent;if(t){t.Qs();const e=wt._matrix4Buffer.copy(t.Ms.matrixWorld).invert();this.Ms.matrix.multiplyMatrices(this.Ms.matrixWorld,e)}else this.Ms.matrix.copy(this.Ms.matrixWorld)}else{const t=this.parent;if(t){t.Qs();const e=wt._matrix4Buffer.copy(t.Ms.matrixWorld).invert();this.Ms.matrix.multiplyMatrices(this.Ms.matrixWorld,e)}else this.Ms.matrix.copy(this.Ms.matrixWorld)}this.ss=!1}Bs(){this.Ls();const t=this.Ms.children;for(let e=0,i=t.length;e<i;++e){const i=t[e];i.userData instanceof wt&&i.userData.Bs()}}Ps(){const t=this.Ms.children;for(let e=0,i=t.length;e<i;++e){const i=t[e];i.userData instanceof wt&&(i.userData.Ls(),i.userData.Ps())}}tryUpdateWorldMatrixRecursivelyFromThisToChildren(){return!!this.yt.exists&&this.qs()}qs(){this.Qs();const t=this.Ms.children;for(let e=0,i=t.length;e<i;++e){const i=t[e];i.userData instanceof wt&&i.userData.qs()}return!0}foreachChild(t){const e=this.Ms.children;for(let i=0,s=e.length;i<s;++i){const s=e[i];s.userData instanceof wt&&t(s.userData)}}iterateChild(t){const e=this.Ms.children;for(let i=0,s=e.length;i<s;++i){const s=e[i];if(s.userData instanceof wt&&!t(s.userData))break}}get parent(){return this.Ms.parent instanceof dt?null:this.Ms.parent.userData}set parent(t){this.setParent(t)}setParent(t,e=!0){if(t){const i=this.parent;this.Bs(),this.As(),this.Ss(),e&&t.getWorldToLocalMatrix(this.Ms.matrix).multiply(this.Ms.matrixWorld),this.Ms.removeFromParent(),t.Ms.add(this.Ms),this.Ws(i,t)}else{const t=this.parent;this.Bs(),this.As(),this.Ss(),e&&this.Ms.matrix.copy(this.Ms.matrixWorld),this.Ms.removeFromParent(),this.T.scene.unsafeGetThreeScene().add(this.Ms),this.Ws(t,null)}}get children(){return this.Ms.children.filter((t=>t.userData instanceof wt)).map((t=>t.userData))}get gameObject(){return this.yt}getForward(t){this.Qs();const e=this.Ms.matrixWorld.elements;return t?t.set(e[8],e[9],e[10]):new F(e[8],e[9],e[10])}setForward(t){this.T.transformMatrixProcessor.enqueueTransformToUpdate(this),this.Qs(),this.Ps(),this.ss=!0,this.hs=!0,this.Es(),this.Ss(),this.rs=!0;const e=this.Ms.matrixWorld.elements,i=wt._vector3Buffer.copy(t).normalize();e[8]=i.x,e[9]=i.y,e[10]=i.z}getRight(t){this.Qs();const e=this.Ms.matrixWorld.elements;return t?t.set(e[0],e[1],e[2]):new F(e[0],e[1],e[2])}setRight(t){this.T.transformMatrixProcessor.enqueueTransformToUpdate(this),this.Qs(),this.Ps(),this.ss=!0,this.hs=!0,this.Es(),this.Ss(),this.rs=!0;const e=this.Ms.matrixWorld.elements,i=wt._vector3Buffer.copy(t).normalize();e[0]=i.x,e[1]=i.y,e[2]=i.z}getUp(t){this.Qs();const e=this.Ms.matrixWorld.elements;return t?t.set(e[4],e[5],e[6]):new F(e[4],e[5],e[6])}setUp(t){this.T.transformMatrixProcessor.enqueueTransformToUpdate(this),this.Qs(),this.Ps(),this.ss=!0,this.hs=!0,this.Es(),this.Ss(),this.rs=!0;const e=this.Ms.matrixWorld.elements,i=wt._vector3Buffer.copy(t).normalize();e[4]=i.x,e[5]=i.y,e[6]=i.z}get localPosition(){return this.Ms.position}get localEulerAngles(){return this.Ms.rotation}get localRotation(){return this.Ms.quaternion}get localScale(){return this.Ms.scale}get position(){return this.Cs}get eulerAngles(){return this.ys}get rotation(){return this.Fs}get lossyScale(){return this.Vs}get hasChanged(){return this.ts}set hasChanged(t){this.ts=t}getWorldToLocalMatrix(t){return this.Qs(),t?t.copy(this.Ms.matrixWorld).invert():this.Ms.matrixWorld.clone().invert()}getLocalToWorldMatrix(t){return this.Qs(),t?t.copy(this.Ms.matrixWorld):this.Ms.matrixWorld.clone()}transformPoint(t){return this.Qs(),this.Ms.localToWorld(t)}inverseTransformPoint(t){return this.Qs(),this.Ms.worldToLocal(t)}transformDirection(t){const e=wt._matrix4Buffer.copy(this.Ms.matrixWorld).makeScale(1,1,1);return t.transformDirection(e)}inverseTransformDirection(t){const e=wt._matrix4Buffer.copy(this.Ms.matrixWorld).makeScale(1,1,1).invert();return t.transformDirection(e)}transformVector(t){return t.transformDirection(this.Ms.matrixWorld)}inverseTransformVector(t){return t.transformDirection(wt._matrix4Buffer.copy(this.Ms.matrixWorld).invert())}isChildOf(t){if(this===t)return!0;const e=this.parent;return!!e&&e.isChildOf(t)}lookAt(t){const e=this.parent;wt._vector3Buffer.setFromMatrixPosition(this.Ms.matrixWorld);const i=wt._matrix4Buffer.lookAt(wt._vector3Buffer,t,this.Ms.up);if(this.Ms.quaternion.setFromRotationMatrix(i),e){i.extractRotation(e.Ms.matrixWorld);const t=wt._quaternionBuffer.setFromRotationMatrix(i);this.Ms.quaternion.premultiply(t.invert())}}setRotationFromAxisAngle(t,e){this.Ms.setRotationFromAxisAngle(t,e)}setRotationFromEuler(t){this.Ms.setRotationFromEuler(t)}setRotationFromMatrix(t){this.Ms.setRotationFromMatrix(t)}setRotationFromQuaternion(t){this.Ms.setRotationFromQuaternion(t)}rotateOnAxis(t,e){return this.Ms.rotateOnAxis(t,e),this}rotateOnWorldAxis(t,e){return this.Ms.rotateOnWorldAxis(t,e),this}rotateX(t){return this.Ms.rotateX(t),this}rotateY(t){return this.Ms.rotateY(t),this}rotateZ(t){return this.Ms.rotateZ(t),this}translateOnAxis(t,e){return this.Ms.translateOnAxis(t,e),this}translateX(t){return this.Ms.translateX(t),this}translateY(t){return this.Ms.translateY(t),this}translateZ(t){return this.Ms.translateZ(t),this}unsafeGetObject3D(){return this.Ms}enqueueRenderAttachedObject3D(t){this.T.transformMatrixProcessor.enqueueRenderObject(t)}dequeueRenderAttachedObject3D(t){this.T.transformMatrixProcessor.dequeueRenderObject(t)}static updateRawObject3DWorldMatrixRecursively(t){t.matrixAutoUpdate&&t.updateMatrix(),t.parent?t.matrixWorld.multiplyMatrices(t.parent.matrixWorld,t.matrix):t.matrixWorld.copy(t.matrix);const e=t.children;for(let t=0,i=e.length;t<i;++t)wt.updateRawObject3DWorldMatrixRecursivelyInternal(e[t])}static updateRawObject3DWorldMatrixRecursivelyInternal(t){t.matrixAutoUpdate&&t.updateMatrix(),t.matrixWorld.multiplyMatrices(t.parent.matrixWorld,t.matrix);const e=t.children;for(let t=0,i=e.length;t<i;++t)wt.updateRawObject3DWorldMatrixRecursivelyInternal(e[t])}toJSON(){return{}}}wt._transformObject3D=class extends ut{updateMatrix(){this.userData.Ns()}updateMatrixWorld(t){this.userData.Qs()}updateWorldMatrix(t,e){if(this.userData.Qs(),e){const t=this.children;for(let e=0,i=t.length;e<i;++e)t[e].updateWorldMatrix(!1,!0)}}},wt._matrix4Buffer=new L,wt._vector3Buffer=new F,wt._quaternionBuffer=new j;class _t{constructor(t,e){this.$t=!1,this.T=t,this._t=t.instantiater.generateId(),this.Mt=!0,this.Nt=!0,this._initialized=!1,this.components=[],this.gameObjectEventContainer=new z,this.Qt=new wt(this,t,this.Vt.bind(this)),this.Qt.unsafeGetObject3D().name=e}addChildFromBuilder(t){this.Xt();const e=t.build(this.transform);return t.processEvent(),e}Vt(t,e){if(e&&this.T!==e.gameObject.T)throw new Error("can't change parent to another engine instance");const i=this.transform.gameObject;e?i.Nt&&i.Zt(e.gameObject.Mt):i.Zt(i.Nt)}addComponent(t){this.Xt();const e=new t(this);if(e.engine_internal_constructAfterProcess(),e.disallowMultipleComponent&&this.getComponent(t))return console.warn(`Component ${t.name} already exists on GameObject ${this.name}`),null;const i=e.requiredComponents;for(let e=0;e<i.length;++e){const s=i[e];if(!this.getComponent(s))return console.warn(`Component ${s.name} is required by Component ${t.name} on GameObject ${this.name}`),null}return this.components.push(e),this.gameObjectEventContainer.registerComponent(e),this.Mt&&e.enabled&&(e._engine_internal_componentEventContainer.tryCallAwake(),e._engine_internal_componentEventContainer.tryRegisterOnEnable(),e._engine_internal_componentEventContainer.tryRegisterStart(),e._engine_internal_componentEventContainer.tryRegisterUpdate(),this.T.sceneProcessor.tryStartProcessSyncedEvent()),e}getComponent(t){this.Xt();const e=this.components;for(let i=0;i<e.length;++i){const s=e[i];if(s instanceof t)return s}return null}getComponents(t){if(this.Xt(),!t)return this.components.slice();const e=this.components,i=[];for(let s=0;s<e.length;++s){const r=e[s];r instanceof t&&i.push(r)}return i}getComponentInChildren(t){this.Xt();const e=this.getComponent(t);if(e)return e;let i=null;return this.Qt.iterateChild((e=>{const s=e.gameObject.getComponentInChildren(t);return!s||(i=s,!1)})),i}getComponentsInChildren(t){if(this.Xt(),t){const e=this.getComponents(t);return this.Qt.foreachChild((i=>{const s=i.gameObject.getComponentsInChildren(t);e.push(...s)})),e}{const t=this.getComponents();return this.Qt.foreachChild((e=>{t.push(...e.gameObject.getComponentsInChildren())})),t}}foreachComponent(t,e){this.Xt();const i=this.components;if(e)for(let s=0;s<i.length;++s){const r=i[s];r instanceof e&&t(r)}else for(let e=0;e<i.length;++e)t(i[e])}foreachComponentInChildren(t,e){this.Xt(),e?(this.foreachComponent(t,e),this.Qt.foreachChild((i=>{i.gameObject.foreachComponentInChildren(t,e)}))):(this.foreachComponent(t),this.Qt.foreachChild((e=>{e.gameObject.foreachComponentInChildren(t)})))}destroy(){_t.destroyRecursively(this),this.T.sceneProcessor.tryStartProcessSyncedEvent(),this.T.sceneProcessor.addRemoveGameObject(this)}static destroyRecursively(t){if(t.$t)return;t.$t=!0,t.te();const e=t.Qt.children;for(let t=0;t<e.length;++t){const i=e[t];i instanceof wt&&_t.destroyRecursively(i.gameObject)}}te(){const t=this.components;for(let e=0;e<t.length;++e){const i=t[e];i._engine_internal_destroyed||(i.enabled&&this.Mt&&(i._engine_internal_componentEventContainer.tryRegisterOnDisable(),i._engine_internal_componentEventContainer.tryUnregisterStart(),i._engine_internal_componentEventContainer.tryUnregisterUpdate()),i.stopAllCoroutines(),i._engine_internal_componentEventContainer.tryRegisterOnDestroy(),i._engine_internal_destroyed=!0)}}removeFromParent(){this.Qt.unsafeGetObject3D().removeFromParent()}removeComponent(t){const e=this.components.indexOf(t);e>=0&&this.components.splice(e,1),this.gameObjectEventContainer.unregisterComponent(t)}get engine(){return this.T}get activeInHierarchy(){return this.Mt}set activeInHierarchy(t){if(this.Mt!==t){if(this.Mt=t,this._initialized){const t=this.components;if(this.Mt)for(let e=0;e<t.length;++e){const i=t[e];i.enabled&&(i._engine_internal_componentEventContainer.tryCallAwake(),i._engine_internal_componentEventContainer.tryRegisterOnEnable(),i._engine_internal_componentEventContainer.tryRegisterStart(),i._engine_internal_componentEventContainer.tryRegisterUpdate())}else for(let e=0;e<t.length;++e){const i=t[e];i.enabled&&(i._engine_internal_componentEventContainer.tryRegisterOnDisable(),i._engine_internal_componentEventContainer.tryUnregisterUpdate(),i.stopAllCoroutines())}}this.Qt.foreachChild((t=>{const e=t.gameObject;this.Mt?e.activeInHierarchy=e.Nt:e.activeInHierarchy=!1}))}}Zt(t){this.Mt!==t&&(this.activeInHierarchy=t,this._initialized&&this.T.sceneProcessor.tryStartProcessSyncedEvent())}get activeSelf(){return this.Nt}set activeSelf(t){this.Xt(),this.Nt!==t&&(this.Nt=t,this.Qt.parent instanceof wt?this.Qt.parent.gameObject.Mt?this.Zt(this.Nt):this.Zt(!1):this.Zt(this.Nt))}get transform(){return this.Qt}get name(){return this.Qt.unsafeGetObject3D().name}set name(t){this.Xt(),this.Qt.unsafeGetObject3D().name=t}get instanceId(){return this._t}get initialized(){return this._initialized}get exists(){return!this.$t}Xt(){if(this.$t)throw new Error("GameObject "+this.name+" is destroyed")}}class Mt{constructor(t,e,i,s,r){this.ee=!1,this.yt=new _t(t,e);const h=this.yt.transform;i&&h.localPosition.copy(i),s&&h.localRotation.copy(s),r&&h.localScale.copy(r),this.$=[],this.ie=[]}active(t){return this.yt.activeSelf=t,this}getGameObject(t){return t.ref=this.yt,this}getComponent(t,e){return e.ref=this.yt.getComponent(t),this}getComponents(t,e){return t.ref=e?this.yt.getComponents(e):this.yt.getComponents(),this}getComponentInChildren(t,e){return e.ref=this.yt.getComponentInChildren(t),this}getComponentsInChildren(t,e){return t.ref=e?this.yt.getComponentsInChildren(e):this.yt.getComponentsInChildren(),this}withComponent(t,e){const i=new t(this.yt);return i.engine_internal_constructAfterProcess(),i.disallowMultipleComponent&&this.yt.getComponent(t)?(console.warn(`Component ${t.name} already exists on GameObject ${this.yt.name}`),this):(this.yt.components.push(i),this.yt.gameObjectEventContainer.registerComponent(i),e&&this.ie.push((()=>e(i))),this)}withChild(t){return this.$.push(t),this}se(t){let e=!1;const i=t.components;for(let s=0;s<i.length;++s){const r=i[s],h=r.requiredComponents;for(let i=0;i<h.length;i++){const s=h[i];t.getComponent(s)||(console.warn(`Component ${s.name} is required by Component ${r.constructor.name} on GameObject ${t.name}`),t.removeComponent(r),e=!0)}}e&&this.se(t)}build(t){if(this.ee)throw new Error("GameObjectBuilder is already built");return this.ee=!0,this.ne(t),this.oe(),this.re(),this.yt}ne(t){this.yt.transform.setParent(t,!1);const e=this.$;for(let t=0;t<e.length;++t)e[t].ne(this.yt.transform)}oe(){this.se(this.yt);const t=this.$;for(let e=0;e<t.length;++e)t[e].oe()}re(){const t=this.ie;for(let e=0;e<t.length;++e)t[e]();const e=this.$;for(let t=0;t<e.length;++t)e[t].re();this.yt._initialized=!0}processEvent(){Mt.processEventByGroup([this],this.yt.engine.sceneProcessor)}static processEventByGroup(t,e){const i=[];for(let e=0;e<t.length;++e)i.push(...t[e].yt.getComponentsInChildren());for(let t=0;t<i.length;++t){const e=i[t];e.gameObject.activeInHierarchy&&e.enabled&&e._engine_internal_componentEventContainer.tryCallAwake()}for(let t=0;t<i.length;++t){const e=i[t];e._engine_internal_destroyed||e.gameObject.activeInHierarchy&&e.enabled&&(e._engine_internal_componentEventContainer.tryRegisterOnEnable(),e._engine_internal_componentEventContainer.tryRegisterStart(),e._engine_internal_componentEventContainer.tryRegisterUpdate())}e.tryStartProcessSyncedEvent()}}class Ct{constructor(t){this.B=0,this.q=0,this.T=t}generateId(){const t=this.B;return this.B+=1,t}generateEventId(){const t=this.q;return this.q+=1,t}buildGameObject(t,e,i,s){return new Mt(this.T,t,e,i,s)}buildPrefab(t,e,i,s,r){return new e(this.T,t,i,s,r)}}class bt{constructor(t,e,i,s,r,h,n,o,a,l){this.t=null,this.i=t,this.h=e,this.o=i,this.u=s,this.g=r,this.p=h,this.l=n,this.m=o,this.I=a,this.G=l,this.P=new c(l),this.H=new Ct(this)}applyGameSetting(t){this.I.applyPhysicsSettings(t.physics)}setWebGLGlobalObject(t){this.t=t}dispose(){this.P.dispose()}get scene(){return this.i}get cameraContainer(){return this.h}get screen(){return this.g}get input(){return this.P}get time(){return this.o}get physics(){return this.I}get gameState(){return this.u}get instantiater(){return this.H}get domElement(){return this.G}get webGL(){return this.t}get sceneProcessor(){return this.p}get coroutineProcessor(){return this.l}get transformMatrixProcessor(){return this.m}get physics2DProcessor(){return this.I}}class Et{constructor(t){this.k=t}get kind(){return this.k}set kind(t){this.k=t}}var St,Ot;(Ot=St||(St={}))[Ot.WaitingForStart=0]="WaitingForStart",Ot[Ot.Initializing=1]="Initializing",Ot[Ot.Running=2]="Running",Ot[Ot.Stopped=3]="Stopped",Ot[Ot.Finalizing=4]="Finalizing",Ot[Ot.Finalized=5]="Finalized";class kt{constructor(){this.ce=new dt,this.ce.matrixAutoUpdate=!1}addChildFromBuilder(t){const e=t.build(null);return t.processEvent(),e}foreachChild(t){const e=this.ce.children;for(let i=0,s=e.length;i<s;++i){const s=e[i];s.userData instanceof wt&&t(s.userData)}}iterateChild(t){const e=this.ce.children;for(let i=0,s=e.length;i<s;++i){const s=e[i];if(s.userData instanceof wt&&!t(s.userData))break}}get children(){return this.ce.children.filter((t=>t.userData instanceof wt)).map((t=>t.userData))}unsafeGetThreeScene(){return this.ce}}class zt{constructor(t=0,e=0){zt.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6],this.y=s[1]*e+s[4]*i+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),s=Math.sin(e),r=this.x-t.x,h=this.y-t.y;return this.x=r*i-h*s+t.x,this.y=r*s+h*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Dt{constructor(){this.Si=null,this.Bi=8,this.Oi=3,this.Li=!0,this.qi=null,this.Hi=null,this._i=new Map,this.Ai=null,this.zi=null,this.reuseCollisionCallbacks=!0,this.Gi=null,this.Ji=null}applyPhysicsSettings(t){var e;if(!t.loader)return;this.Ai=t.loader,this.Hi=new this.Ai.World(new this.Ai.Vec2(0,-9.81));const i=class extends this.Ai.ContactListener{constructor(t){super(),this.Ki=t,this.Qi=new this.Ki.Ai.Collision2DPool,this.Ui=new this.Ki.Ai.TriggerEventPool,this.Wi=new this.Ki.Ai.CollisionEventPool}BeginContact(t){const e=t.GetFixtureA().GetUserData(),i=t.GetFixtureB().GetUserData();if(e.isTrigger||i.isTrigger)this.Ui.insert(0,e,i);else if(this.Ki.reuseCollisionCallbacks){const s=this.Qi.getInstance();s.setData(t),this.Wi.insert(0,e,i,s,this.Qi)}else{const s=new this.Ki.Ai.Collision2D;s.setData(t),this.Wi.insert(0,e,i,s)}}EndContact(t){const e=t.GetFixtureA().GetUserData(),i=t.GetFixtureB().GetUserData();if(e.isTrigger||i.isTrigger)this.Ui.insert(2,e,i);else if(this.Ki.reuseCollisionCallbacks){const s=this.Qi.getInstance();s.setData(t),this.Wi.insert(2,e,i,s,this.Qi)}else{const s=new this.Ki.Ai.Collision2D;s.setData(t),this.Wi.insert(2,e,i,s)}}PreSolve(t,e){const i=t.GetFixtureA().GetUserData(),s=t.GetFixtureB().GetUserData();if(i.isTrigger||s.isTrigger)this.Ui.insert(1,i,s);else if(this.Ki.reuseCollisionCallbacks){const e=this.Qi.getInstance();e.setData(t),this.Wi.insert(1,i,s,e,this.Qi)}else{const e=new this.Ki.Ai.Collision2D;e.setData(t),this.Wi.insert(1,i,s,e)}}onTriggerInvoke(){this.Ui.invoke()}onCollisionInvoke(){this.Wi.invoke()}},s=new i(this);this.zi=s,this.Hi.SetContactListener(s),t.gravity&&(null===(e=this.Hi)||void 0===e||e.SetGravity(t.gravity)),t.defaultMaterial&&(this.Si=t.defaultMaterial.clone()),t.velocityIterations&&(this.Bi=t.velocityIterations),t.positionIterations&&(this.Oi=t.positionIterations),t.queriesHitTriggers&&(this.Li=t.queriesHitTriggers),t.reuseCollisionCallbacks&&(this.reuseCollisionCallbacks=t.reuseCollisionCallbacks),t.collisionLayerMaskMatrix?this.qi=new this.Ai.CollisionLayerMaskConverter(t.collisionLayerMaskMatrix):this.qi=new this.Ai.CollisionLayerMaskConverter({default:{default:!0}}),this.Gi=new this.Ai.RayCastOneCallback(this),this.Ji=new this.Ai.RayCastFilterCallback}update(t){if(this.Hi){{let t=this.Hi.GetBodyList();for(;t;){const e=t;t=t.GetNext();const i=e.GetUserData().gameObject.transform,s=i.position,r=i.eulerAngles,h=e.GetPosition(),n=e.GetAngle();s.x===h.x&&s.y===h.y||(e.SetPosition(s),e.SetAwake(!0)),r.z!==n&&(e.SetAngle(r.z),e.SetAwake(!0))}}this.Hi.Step(t,this.Bi,this.Oi);{let t=this.Hi.GetBodyList();for(;t;){const e=t;t=t.GetNext();const i=e.GetUserData().gameObject.transform;i.position.x=e.GetPosition().x,i.position.y=e.GetPosition().y,i.eulerAngles.z=e.GetAngle()}}this.zi.onTriggerInvoke(),this.zi.onCollisionInvoke()}}addRigidBody(t,e,i){if(!this.Hi)throw new Error("Physics2D is not loaded.");let s=this._i.get(t);if(s){const t=s.addRigidBody(e),r=t.body;return r.SetType(i.type),r.SetPosition(i.position),r.SetAngle(i.angle),r.SetLinearVelocity(i.linearVelocity),r.SetAngularVelocity(i.angularVelocity),r.SetLinearDamping(i.linearDamping),r.SetAngularDamping(i.angularDamping),r.SetSleepingAllowed(i.allowSleep),r.SetAwake(i.awake),r.SetFixedRotation(i.fixedRotation),r.SetBullet(i.bullet),r.SetEnabled(i.enabled),r.SetUserData(i.userData),r.SetGravityScale(i.gravityScale),t}return s=new this.Ai.PhysicsObject2D(t,this.Hi.CreateBody(i),(()=>this._i.delete(t))),this._i.set(t,s),s.addRigidBody(e)}removeRigidBody(t){const e=this._i.get(t);if(!e)throw new Error("PhysicsObject2D not found");e.removeRigidBody()}Xi(t){const e=new this.Ai.BodyDef;return e.type=this.Ai.BodyType.b2_kinematicBody,e.position.x=t.transform.position.x,e.position.y=t.transform.position.y,e.angle=t.transform.eulerAngles.z,e}addCollider(t,e){if(!this.Hi)throw new Error("Physics2D is not loaded.");let i=this._i.get(t);return i||(i=new this.Ai.PhysicsObject2D(t,this.Hi.CreateBody(this.Xi(t)),(()=>this._i.delete(t)))),this._i.set(t,i),i.addCollider(e)}removeCollider(t,e,i){const s=this._i.get(t);if(!s)throw new Error("PhysicsObject2D not found");s.removeCollider(e,i)}get physicsLoader(){return this.Ai}get gravity(){if(!this.Hi)throw new Error("Physics2D is not loaded.");const t=this.Hi.GetGravity();return new zt(t.x,t.y)}set gravity(t){if(!this.Hi)throw new Error("Physics2D is not loaded.");this.Hi.SetGravity(new this.Ai.Vec2(t.x,t.y))}get defaultMaterial(){return this.Si}get velocityIterations(){return this.Bi}set velocityIterations(t){this.Bi=t}get positionIterations(){return this.Oi}set positionIterations(t){this.Oi=t}get maxLinearCorrection(){if(!this.Ai)throw new Error("Physics2D is not loaded.");return this.Ai.maxLinearCorrection}get maxAngularCorrection(){if(!this.Ai)throw new Error("Physics2D is not loaded.");return this.Ai.maxAngularCorrection}get maxTranslationSpeed(){if(!this.Ai)throw new Error("Physics2D is not loaded.");return this.Ai.maxTranslation}get maxRotationSpeed(){if(!this.Ai)throw new Error("Physics2D is not loaded.");return this.Ai.maxRotation}get baumgarteScale(){if(!this.Ai)throw new Error("Physics2D is not loaded.");return this.Ai.baumgarte}get baumgarteTimeOfImpactScale(){if(!this.Ai)throw new Error("Physics2D is not loaded.");return this.Ai.toiBaumgarte}get timeToSleep(){if(!this.Ai)throw new Error("Physics2D is not loaded.");return this.Ai.timeToSleep}get linearSleepTolerance(){if(!this.Ai)throw new Error("Physics2D is not loaded.");return this.Ai.linearSleepTolerance}get angularSleepTolerance(){if(!this.Ai)throw new Error("Physics2D is not loaded.");return this.Ai.angularSleepTolerance}get queriesHitTriggers(){return this.Li}set queriesHitTriggers(t){this.Li=t}get collisionLayerMask(){return this.qi}raycastOne(t,e,i,s=Number.POSITIVE_INFINITY,r=4294967295,h=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY){if(!this.Hi)throw new Error("Physics2D is not loaded.");i||(i=new this.Ai.RaycastHit2D);const o=Dt._raycastEndPoint.copy(e).multiplyScalar(s===Number.POSITIVE_INFINITY?1e7:s).add(t);return this.Gi.setRaycastData(i,t,r,h,n),this.Hi.RayCast(this.Gi,t,o),this.Gi.hit?i:null}raycast(t,e,i,s,r=Number.POSITIVE_INFINITY){if(!this.Hi)throw new Error("Physics2D is not loaded.");const h=Dt._raycastEndPoint.copy(e).multiplyScalar(r===Number.POSITIVE_INFINITY?1e7:r).add(t);return this.Ji.setRaycastData(s,t,i),this.Hi.RayCast(this.Ji,t,h),this.Ji.hitCount}}Dt._raycastEndPoint=new zt;class At{constructor(t){this.ai=null,this.ui=new Map,this.li=new E(void 0,((t,e)=>t.info.priority===e.info.priority?t.camera.instanceId-e.camera.instanceId:e.info.priority-t.info.priority)),this.di=t,this.mi=new l}get camera(){var t,e;return null!==(e=null===(t=this.ai)||void 0===t?void 0:t.camera)&&void 0!==e?e:null}get currentCameraPriority(){var t,e;return null!==(e=null===(t=this.ai)||void 0===t?void 0:t.info.priority)&&void 0!==e?e:Number.MIN_SAFE_INTEGER}addCamera(t,e){this.ui.set(t,e),this.li.insert({camera:t,info:e}),this.vi()}removeCamera(t){const e=this.ui.get(t);e&&(this.li.eraseElementByKey({camera:t,info:e}),this.ui.delete(t),this.vi())}changeCameraPriority(t,e){const i=this.ui.get(t);i&&(this.li.eraseElementByKey({camera:t,info:i}),i.priority=e,this.li.insert({camera:t,info:i}),this.vi())}changeCameraBackgroundColor(t,e){var i;const s=this.ui.get(t);s&&(s.backgroundColor=e,(null===(i=this.ai)||void 0===i?void 0:i.camera)===t&&this.di(e))}vi(){var t;if(0===this.li.size())return void(this.ai=null);const e=this.li.front();e?(null===(t=this.ai)||void 0===t?void 0:t.camera)!==e.camera&&(this.ai=e,this.di(this.ai.info.backgroundColor),this.mi.invoke(this.ai.camera)):this.ai=null}get onCameraChanged(){return this.mi}}class Rt{constructor(t=0,e=0,i=0,s=1){1<t?t=1:0>t&&(t=0),1<e?e=1:0>e&&(e=0),1<i?i=1:0>i&&(i=0),1<s?s=1:0>s&&(s=0),this.fi=t,this.ci=e,this.Mi=i,this.gi=s}set(t,e,i,s=1){return 1<t?t=1:0>t&&(t=0),1<e?e=1:0>e&&(e=0),1<i?i=1:0>i&&(i=0),1<s?s=1:0>s&&(s=0),this.fi=t,this.ci=e,this.Mi=i,this.gi=s,this}copy(t){return this.fi=t.r,this.ci=t.g,this.Mi=t.b,this.gi=t.a,this}clone(){return new Rt(this.fi,this.ci,this.Mi,this.gi)}get r(){return this.fi}set r(t){1<t?t=1:0>t&&(t=0),this.fi=t}get g(){return this.ci}set g(t){1<t?t=1:0>t&&(t=0),this.ci=t}get b(){return this.Mi}set b(t){1<t?t=1:0>t&&(t=0),this.Mi=t}get a(){return this.gi}set a(t){1<t?t=1:0>t&&(t=0),this.gi=t}toString(){return"rgb("+255*this.fi+", "+255*this.ci+", "+255*this.Mi+")"}toStringWithAlpha(){return"rgba("+255*this.fi+", "+255*this.ci+", "+255*this.Mi+", "+this.gi+")"}toHex(){return"#"+((Math.round(255*this.fi)<<16)+(Math.round(255*this.ci)<<8)+(Math.round(255*this.Mi)<<0)).toString(16).padStart(6,"0")}toHexWithAlpha(){return"#"+((Math.round(255*this.fi)<<16)+(Math.round(255*this.ci)<<8)+(Math.round(255*this.Mi)<<0)).toString(16).padStart(6,"0")+Math.round(255*this.gi).toString(16).padStart(2,"0")}toArray(){return[this.fi,this.ci,this.Mi,this.gi]}static fromHex(t){const e=parseInt(t.slice(1,3),16)/255,i=parseInt(t.slice(3,5),16)/255,s=parseInt(t.slice(5,7),16)/255;return new Rt(e,i,s)}static fromArray(t){return new Rt(t[0],t[1],t[2],t[3])}static fromString(t){const e=t.match(/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d*(?:\.\d+)?)\)$/);return e?new Rt(parseInt(e[1]),parseInt(e[2]),parseInt(e[3]),parseFloat(e[4])):Rt.fromHex(t)}hueRotate(t=0,e){t=t/180*Math.PI;const i=Math.sin(t),s=Math.cos(t);this.multiplyMatrix((null!=e?e:new Z).set(.213+.787*s-.213*i,.715-.715*s-.715*i,.072-.072*s+.928*i,.213-.213*s+.143*i,.715+.285*s+.14*i,.072-.072*s-.283*i,.213-.213*s-.787*i,.715-.715*s+.715*i,.072+.928*s+.072*i))}grayscale(t=1,e){this.multiplyMatrix((null!=e?e:new Z).set(.2126+.7874*(1-t),.7152-.7152*(1-t),.0722-.0722*(1-t),.2126-.2126*(1-t),.7152+.2848*(1-t),.0722-.0722*(1-t),.2126-.2126*(1-t),.7152-.7152*(1-t),.0722+.9278*(1-t)))}sepia(t=1,e){this.multiplyMatrix((null!=e?e:new Z).set(.393+.607*(1-t),.769-.769*(1-t),.189-.189*(1-t),.349-.349*(1-t),.686+.314*(1-t),.168-.168*(1-t),.272-.272*(1-t),.534-.534*(1-t),.131+.869*(1-t)))}saturate(t=1,e){this.multiplyMatrix((null!=e?e:new Z).set(.213+.787*t,.715-.715*t,.072-.072*t,.213-.213*t,.715+.285*t,.072-.072*t,.213-.213*t,.715-.715*t,.072+.928*t))}brightness(t=1){this.linear(t)}contrast(t=1){this.linear(t,-.5*t+.5)}invert(t=1){let e=t+this.fi*(1-2*t),i=t+this.ci*(1-2*t),s=t+this.Mi*(1-2*t);1<e?e=1:e<0&&(e=0),1<i?i=1:i<0&&(i=0),1<s?s=1:s<0&&(s=0),this.fi=e,this.ci=i,this.Mi=s}multiplyMatrix(t){const e=t.elements;let i=this.fi*e[0]+this.ci*e[1]+this.Mi*e[2],s=this.fi*e[3]+this.ci*e[4]+this.Mi*e[5],r=this.fi*e[6]+this.ci*e[7]+this.Mi*e[8];return 1<i?i=1:i<0&&(i=0),1<s?s=1:s<0&&(s=0),1<r?r=1:r<0&&(r=0),this.fi=i,this.ci=s,this.Mi=r,this}linear(t=1,e=0){let i=this.fi*t+e,s=this.ci*t+e,r=this.Mi*t+e;return 1<i?i=1:i<0&&(i=0),1<s?s=1:s<0&&(s=0),1<r?r=1:r<0&&(r=0),this.fi=i,this.ci=s,this.Mi=r,this}hsl(){const t=this.fi,e=this.ci,i=this.Mi,s=Math.max(t,e,i),r=Math.min(t,e,i);let h,n;const o=(s+r)/2;if(s===r)h=n=0;else{const a=s-r;switch(n=o>.5?a/(2-s-r):a/(s+r),s){case t:h=(e-i)/a+(e<i?6:0);break;case e:h=(i-t)/a+2;break;case i:h=(t-e)/a+4;break;default:throw new Error("Unreachable")}h/=6}return{h,s:n,l:o}}}class Pt{constructor(t,e){this.xe=t,this.Me=e,this.Ge=new l}get width(){return this.xe}get height(){return this.Me}get onResize(){return this.Ge}resize(t,e){this.xe=t,this.Me=e,this.Ge.invoke(t,e)}}const Tt=new F,jt=new j,Ft=new F,It=new L,Wt=new L;class Lt{constructor(){this.xe=0,this.Me=0,this.Se=0,this.je=0,this._e={camera:{fov:0,style:""}};const t=document.createElement("div");t.style.overflow="hidden",this.domElement=t,this.De=document.createElement("div"),this.De.style.transformStyle="preserve-3d",this.De.style.pointerEvents="none",this.domElement.appendChild(this.De)}getSize(){return{width:this.xe,height:this.Me}}render(t,e,i){const s=i.projectionMatrix.elements[5]*this.je;let r,h;this._e.camera.fov!==s&&(this.domElement.style.perspective=i.isPerspectiveCamera?s+"px":"",this._e.camera.fov=s),!0===e.matrixAutoUpdate&&e.updateMatrixWorld(),null===i.parent&&i.updateMatrixWorld(),i.isOrthographicCamera?(r=-(i.right+i.left)/2,h=(i.top+i.bottom)/2):(r=1,h=1);const n=(i.isOrthographicCamera?"scale("+s+")translate("+this.Oe(r)+"px,"+this.Oe(h)+"px)"+this.Qe(i.matrixWorldInverse):"translateZ("+s+"px)"+this.Qe(i.matrixWorldInverse))+"translate("+this.Se+"px,"+this.je+"px)";this._e.camera.style!==n&&(this.De.style.transform=n,this._e.camera.style=n);for(const s of t)this.Ve(s,e,i)}setSize(t,e){this.xe=t,this.Me=e,this.Se=this.xe/2,this.je=this.Me/2,this.domElement.style.width=t+"px",this.domElement.style.height=e+"px",this.De.style.width=t+"px",this.De.style.height=e+"px"}Oe(t){return Math.abs(t)<1e-10?0:t}Qe(t){const e=t.elements,i=this.Oe;return"matrix3d("+i(e[0])+","+i(-e[1])+","+i(e[2])+","+i(e[3])+","+i(e[4])+","+i(-e[5])+","+i(e[6])+","+i(e[7])+","+i(e[8])+","+i(-e[9])+","+i(e[10])+","+i(e[11])+","+i(e[12])+","+i(-e[13])+","+i(e[14])+","+i(e[15])+")"}ze(t){const e=t.elements,i=this.Oe;return"translate(-50%,-50%)matrix3d("+i(e[0])+","+i(e[1])+","+i(e[2])+","+i(e[3])+","+i(-e[4])+","+i(-e[5])+","+i(-e[6])+","+i(-e[7])+","+i(e[8])+","+i(e[9])+","+i(e[10])+","+i(e[11])+","+i(e[12])+","+i(e[13])+","+i(e[14])+","+i(e[15])+")"}Ve(t,e,i){if(t.isCSS3DObject){let s;t.onBeforeRender(this,e,i),t.isCSS3DSprite?(It.copy(i.matrixWorldInverse),It.transpose(),0!==t.rotation2D&&It.multiply(Wt.makeRotationZ(t.rotation2D)),t.matrixWorld.decompose(Tt,jt,Ft),It.setPosition(Tt),It.scale(Ft),It.elements[3]=0,It.elements[7]=0,It.elements[11]=0,It.elements[15]=1,s=this.ze(It)):s=this.ze(t.matrixWorld);const r=t.element;r.style.transform=s,r.style.display=t.visible?"":"none",r.parentNode!==this.De&&this.De.appendChild(r),t.onAfterRender(this,e,i)}}}class Bt{constructor(){this.qe=[],this.Te=new Set,this.Re=new Set}Be(){const t=this.Te;this.Te=this.Re,this.Re=t}enqueueTransformToUpdate(t){t.isRegisteredToProcessor||(t.isRegisteredToProcessor=!0,this.qe.push(t))}enqueueRenderObject(t){this.Re.add(t)}dequeueRenderObject(t){this.Re.delete(t)}flush(){this.Te.clear()}update(){const t=this.qe;for(let e=0;e<t.length;++e){const i=t[e];i.tryUpdateWorldMatrixRecursivelyFromThisToChildren(),i.isRegisteredToProcessor=!1}return this.qe.length=0,this.Be(),this.Te}}class Gt{constructor(t,e){this.Le=t,this.L=e,this.We=null}dispose(){this.L&&this.L.dispose()}get renderer(){return this.Le}get webglRenderer(){return this.L}get effectComposer(){return this.We}set effectComposer(t){this.We=t}}class qt{constructor(){this.N=new S(O.comparator),this.J=new S(O.comparator),this.U=!1,this.V=[],this.X=[]}addEventToNonSyncedCollection(t){this.N.insert(t)}removeEventFromNonSyncedCollection(t){this.N.delete(t)}addEventToSyncedCollection(t){this.J.insert(t)}startProcessNonSyncedEvent(){this.N.forEach((t=>t.invoke()))}tryStartProcessSyncedEvent(){this.U||(this.U=!0,this.J.forEach((t=>t.invoke())),this.J.clear(),this.U=!1)}addRemoveGameObject(t){this.V.push(t)}addRemoveComponent(t){this.X.push(t)}processRemoveObject(){const t=this.X;for(let e=0;e<t.length;++e)t[e].gameObject.removeComponent(t[e]);const e=this.V;for(let t=0;t<e.length;++t)e[t].removeFromParent()}}class Nt{constructor(){this.ke=1/3,this.Ae=0,this.o=0,this.Fe=0,this.He=0,this.Ie=0,this.Je=1}start(){this.Ae=performance.now()}update(){const t=performance.now();let e=(t-this.Ae)/1e3;this.ke<e&&(e=this.ke),this.Ie=e,this.Fe+=e,this.He=e*this.Je,this.o+=this.He,this.Ae=t}get time(){return this.o}get unscaledTime(){return this.Fe}get deltaTime(){return this.He}get unscaledDeltaTime(){return this.Ie}get timeScale(){return this.Je}set timeScale(t){this.Je=t}get maximumDeltaTime(){return this.ke}set maximumDeltaTime(t){this.ke=t}}class Ht{constructor(t){this.p=t,this.$=[]}withChild(t){return this.$.push(t),this}build(){const t=this.$;for(let e=0;e<t.length;++e)t[e].build(null);Mt.processEventByGroup(t,this.p)}}class Ut{constructor(t){this.yi=t}static createDefaultObject(){return{}}loader(t){return this.yi.loader=t,this}gravity(t){return this.yi.gravity=t,this}defaultMaterial(t){return this.yi.defaultMaterial=t,this}velocityIterations(t){return this.yi.velocityIterations=t,this}positionIterations(t){return this.yi.positionIterations=t,this}queriesHitTriggers(t){return this.yi.queriesHitTriggers=t,this}reuseCollisionCallbacks(t){return this.yi.reuseCollisionCallbacks=t,this}layerCollisionMatrix(t){return this.yi.collisionLayerMaskMatrix=t,this}}class Yt{constructor(t){this.Ye=t}static createDefaultObject(){return{useCss3DRenderer:!0}}useCss3DRenderer(t){return this.Ye.useCss3DRenderer=t,this}webGLRendererLoader(t){return this.Ye.webGLRendererLoader=t,this}webGLRenderer(t){return this.Ye.webGLRendererInitilizer=t,this}}class Xt{constructor(t){this.Ne=t,this.Ue=new Yt(this.Ne.render),this.Xe=new Ut(this.Ne.physics)}static createDefaultObject(){return{render:Yt.createDefaultObject(),physics:Ut.createDefaultObject()}}get render(){return this.Ue}get physics(){return this.Xe}make(){return this.Ne}}class Vt{constructor(t=null){this.ref=t}}class Qt extends ut{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new L,this.projectionMatrix=new L,this.projectionMatrixInverse=new L}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Kt extends Qt{constructor(t=50,e=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*R*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*A*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*R*Math.atan(Math.tan(.5*A*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,s,r,h){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=h,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*A*this.fov)/this.zoom,i=2*e,s=this.aspect*i,r=-.5*s;const h=this.view;if(null!==this.view&&this.view.enabled){const t=h.fullWidth,n=h.fullHeight;r+=h.offsetX*s/t,e-=h.offsetY*i/n,s*=h.width/t,i*=h.height/n}const n=this.filmOffset;0!==n&&(r+=t*n/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}class Zt extends Qt{constructor(t=-1,e=1,i=1,s=-1,r=.1,h=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=s,this.near=r,this.far=h,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,s,r,h){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=r,this.view.height=h,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let r=i-t,h=i+t,n=s+e,o=s-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,h=r+t*this.view.width,n-=e*this.view.offsetY,o=n-e*this.view.height}this.projectionMatrix.makeOrthographic(r,h,n,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}class Jt{constructor(t,e,i){this.ct=t,this.gt=0,this.vt=e,this.xt=null,this.It=!1,this.Tt=i}get component(){return this.ct}get elapsedTime(){return this.gt}set elapsedTime(t){this.gt=t}get currentYieldInstruction(){return this.xt}get currentYieldInstructionExist(){return this.It}fatchNextInstruction(){var t;const e=this.vt.next();return e.done?(this.xt=null,this.It=!1,null===(t=this.Tt)||void 0===t||t.call(this),this.Tt=null,null):(this.xt=e.value,this.It=!0,this.xt)}}class $t{constructor(){this.awakeCalled=!1,this.startRegistered=!1,this.startCalled=!1,this.updateRegistered=!1,this.enabled=!1}}class te{constructor(t){this.Ut=null,this.Rt=null,this.jt=null,this.qt=null,this.zt=null,this.Bt=null,this.Gt=null,this.Ht=null,this.Jt=null,this.Kt=null,this.ct=t,this.p=t.engine.sceneProcessor,this.H=t.engine.instantiater,this.Lt=new $t,function(t){return void 0!==t.awake}(t)&&(this.Ut=O.createAwakeEvent(this.H,t.awake.bind(t))),function(t){return void 0!==t.onDestroy}(t)&&(this.Rt=O.createOnDestroyEvent(this.H,t.onDestroy.bind(t),t.executionOrder)),function(t){return void 0!==t.onCollisionEnter2D}(t)&&(this.jt=O.createOnCollisionEnter2DEvent(this.H,(e=>t.onCollisionEnter2D(e)),t.executionOrder)),function(t){return void 0!==t.onCollisionStay2D}(t)&&(this.qt=O.createOnCollisionStay2DEvent(this.H,(e=>t.onCollisionStay2D(e)),t.executionOrder)),function(t){return void 0!==t.onCollisionExit2D}(t)&&(this.zt=O.createOnCollisionExit2DEvent(this.H,(e=>t.onCollisionExit2D(e)),t.executionOrder)),function(t){return void 0!==t.onTriggerEnter2D}(t)&&(this.Bt=O.createOnTriggerEnter2DEvent(this.H,(e=>t.onTriggerEnter2D(e)),t.executionOrder)),function(t){return void 0!==t.onTriggerStay2D}(t)&&(this.Gt=O.createOnTriggerStay2DEvent(this.H,(e=>t.onTriggerStay2D(e)),t.executionOrder)),function(t){return void 0!==t.onTriggerExit2D}(t)&&(this.Ht=O.createOnTriggerExit2DEvent(this.H,(e=>t.onTriggerExit2D(e)),t.executionOrder)),function(t){return void 0!==t.start}(t)&&(this.Jt=O.createStartEvent(this.H,(()=>{this.Lt.startCalled=!0,t.start(),this.Lt.startRegistered&&this.p.removeEventFromNonSyncedCollection(this.Jt)}),t.executionOrder)),function(t){return void 0!==t.update}(t)&&(this.Kt=O.createUpdateEvent(this.H,t.update.bind(t),t.executionOrder))}tryCallAwake(){var t;this.Lt.awakeCalled||(this.Lt.awakeCalled=!0,null===(t=this.Ut)||void 0===t||t.invoke())}tryRegisterOnEnable(){if(this.ct._engine_internal_destroyed)return;if(this.Lt.enabled)return;if(this.Lt.enabled=!0,!function(t){return void 0!==t.onEnable}(this.ct))return;const t=O.createOnEnableEvent(this.H,this.ct.onEnable.bind(this.ct),this.ct.executionOrder);this.p.addEventToSyncedCollection(t)}tryRegisterOnDisable(){if(this.ct._engine_internal_destroyed)return;if(!this.Lt.enabled)return;if(this.Lt.enabled=!1,!function(t){return void 0!==t.onDisable}(this.ct))return;const t=O.createOnDisableEvent(this.H,this.ct.onDisable.bind(this.ct),this.ct.executionOrder);this.p.addEventToSyncedCollection(t)}tryRegisterOnDestroy(){this.Rt&&this.p.addEventToSyncedCollection(this.Rt)}tryRegisterStart(){this.Jt&&(this.ct._engine_internal_destroyed||this.Lt.startCalled||this.Lt.startRegistered||(this.Lt.startRegistered=!0,this.p.addEventToNonSyncedCollection(this.Jt)))}tryUnregisterStart(){this.Jt&&this.Lt.startRegistered&&!this.Lt.startCalled&&(this.Lt.startRegistered=!1,this.p.removeEventFromNonSyncedCollection(this.Jt))}tryRegisterUpdate(){this.Kt&&(this.ct._engine_internal_destroyed||this.Lt.updateRegistered||(this.Lt.updateRegistered=!0,this.p.addEventToNonSyncedCollection(this.Kt)))}tryUnregisterUpdate(){this.Kt&&this.Lt.updateRegistered&&(this.Lt.updateRegistered=!1,this.p.removeEventFromNonSyncedCollection(this.Kt))}get onCollisionEnter2D(){return this.jt}get onCollisionStay2D(){return this.qt}get onCollisionExit2D(){return this.zt}get onTriggerEnter2D(){return this.Bt}get onTriggerStay2D(){return this.Gt}get onTriggerExit2D(){return this.Ht}}class ee{constructor(t){this.disallowMultipleComponent=!1,this.requiredComponents=[],this.executionOrder=0,this._private__runningCoroutines=[],this._engine_internal_destroyed=!1,this._private__enabled=!0,this._private__gameObject=t,this._private__instanceId=t.engine.instantiater.generateId(),this._engine_internal_componentEventContainer=null}engine_internal_constructAfterProcess(){this._engine_internal_componentEventContainer=new te(this),Object.defineProperties(this,{disallowMultipleComponent:{configurable:!1,writable:!1},requiredComponents:{configurable:!1,writable:!1},executionOrder:{configurable:!1,writable:!1}})}startCoroutine(t){this._private_checkComponentIsExist();const e=new Jt(this,t,(()=>{const t=this._private__runningCoroutines.indexOf(e);t>=0&&this._private__runningCoroutines.splice(t,1)}));return e.fatchNextInstruction(),this._private__gameObject.activeInHierarchy?(this._private__runningCoroutines.push(e),this.engine.coroutineProcessor.addCoroutine(e),e):e}stopAllCoroutines(){this._private_checkComponentIsExist();const t=this._private__runningCoroutines,e=this.engine.coroutineProcessor;for(let i=0;i<t.length;++i){const s=t[i];if(s.component!==this)throw new Error("Coroutine is not owned by this component");e.removeCoroutine(s)}t.length=0}stopCoroutine(t){if(this._private_checkComponentIsExist(),t.component!==this)throw new Error("Coroutine is not owned by this component");this.engine.coroutineProcessor.removeCoroutine(t);const e=this._private__runningCoroutines.indexOf(t);e>=0&&this._private__runningCoroutines.splice(e,1)}get enabled(){return this._private__enabled}set enabled(t){this._private_checkComponentIsExist(),this._private__enabled!==t&&(this._private__enabled=t,this._private__gameObject.initialized&&this._private__gameObject.activeInHierarchy&&(this._private__enabled?(this._engine_internal_componentEventContainer.tryRegisterOnEnable(),this._engine_internal_componentEventContainer.tryRegisterStart(),this._engine_internal_componentEventContainer.tryRegisterUpdate(),this.engine.sceneProcessor.tryStartProcessSyncedEvent()):(this._engine_internal_componentEventContainer.tryRegisterOnDisable(),this._engine_internal_componentEventContainer.tryUnregisterStart(),this._engine_internal_componentEventContainer.tryUnregisterUpdate(),this.engine.sceneProcessor.tryStartProcessSyncedEvent())))}_private_checkComponentIsExist(){if(this._engine_internal_destroyed)throw new Error("Component "+this.constructor.name+" is destroyed")}get gameObject(){return this._private__gameObject}get transform(){return this._private__gameObject.transform}get engine(){return this._private__gameObject.engine}get instanceId(){return this._private__instanceId}get initialized(){return this._private__gameObject.initialized}get exists(){return!this._engine_internal_destroyed}destroy(){this._engine_internal_destroyed||(this.enabled&&this.gameObject.activeInHierarchy&&(this._engine_internal_componentEventContainer.tryRegisterOnDisable(),this._engine_internal_componentEventContainer.tryUnregisterStart(),this._engine_internal_componentEventContainer.tryUnregisterUpdate()),this.stopAllCoroutines(),this._engine_internal_componentEventContainer.tryRegisterOnDestroy(),this._engine_internal_destroyed=!0,this.engine.sceneProcessor.tryStartProcessSyncedEvent(),this.engine.sceneProcessor.addRemoveComponent(this))}}class ie{constructor(t,e){this.Dt=t,this.io=null===e?null:e instanceof Rt?e.clone():e}get priority(){return this.Dt}set priority(t){this.Dt=t}get backgroundColor(){return this.io}set backgroundColor(t){null===t?this.io=null:t instanceof Rt?this.io instanceof Rt?this.io.copy(t):this.io=t.clone():this.io=t}}var se,re,he,ne;!function(t){t[t.Perspective=0]="Perspective",t[t.Orthographic=1]="Orthographic"}(se||(se={}));class oe extends ee{constructor(){super(...arguments),this.mh=null,this.Ta=se.Orthographic,this.ya=75,this.Oa=5,this.Pa=1,this._a=.1,this.ba=1e3,this.Dt=0,this.io=null,this.h=null,this.ka=(t,e)=>{const i=t/e;if(this.mh instanceof Kt)this.mh.aspect=i,this.mh.updateProjectionMatrix();else if(this.mh instanceof Zt){const t=this.Oa;this.mh.left=-t*i,this.mh.right=t*i,this.mh.top=t,this.mh.bottom=-t,this.mh.updateProjectionMatrix()}}}awake(){this.h=this.engine.cameraContainer}onEnable(){this.engine.screen.onResize.addListener(this.ka),this.za()}onWorldMatrixUpdated(){this.mh&&(wt.updateRawObject3DWorldMatrixRecursively(this.mh),this.mh.matrixWorldInverse.copy(this.mh.matrixWorld).invert())}za(){const t=this.engine.screen.width/this.engine.screen.height;if(this.Ta===se.Perspective)this.mh?this.mh instanceof Kt?(this.mh.aspect=t,this.mh.fov=this.ya,this.mh.near=this._a,this.mh.far=this.ba,this.mh.updateProjectionMatrix()):(this.mh.removeFromParent(),oe.removeCameraFromDuckPool(this.mh),this.mh=this.Da(),this.transform.unsafeGetObject3D().add(this.mh)):(this.mh=this.Da(),this.transform.unsafeGetObject3D().add(this.mh));else{if(this.Ta!==se.Orthographic)throw new Error("Camera type not supported");if(this.mh)if(this.mh instanceof Zt){const e=this.Oa;this.mh.left=-e*t,this.mh.right=e*t,this.mh.top=e,this.mh.bottom=-e,this.mh.near=this._a,this.mh.far=this.ba,this.mh.updateProjectionMatrix()}else this.mh.removeFromParent(),oe.removeCameraFromDuckPool(this.mh),this.mh=this.ja(),this.transform.unsafeGetObject3D().add(this.mh);else this.mh=this.ja(),this.transform.unsafeGetObject3D().add(this.mh)}wt.updateRawObject3DWorldMatrixRecursively(this.mh),this.h.addCamera(this,new ie(this.Dt,this.io))}Da(){const t=this.engine.screen.width/this.engine.screen.height,e=new Kt(this.ya,t,this._a,this.ba);return 1!==this.Pa&&(e.zoom=this.Pa,e.updateProjectionMatrix()),e}ja(){const t=this.engine.screen.width/this.engine.screen.height,e=this.Oa,i=new Zt(-e*t,e*t,e,-e,this._a,this.ba);return 1!==this.Pa&&(i.zoom=this.Pa,i.updateProjectionMatrix()),i}onDisable(){this.engine.screen.onResize.removeListener(this.ka),this.mh&&this.h.removeCamera(this)}onDestroy(){this.mh&&(this.mh.removeFromParent(),oe.removeCameraFromDuckPool(this.mh))}get cameraType(){return this.Ta}set cameraType(t){this.Ta!==t&&(this.Ta=t,this.mh&&this.za())}get fov(){return this.mh instanceof Kt?this.ya=this.mh.fov:this.ya}set fov(t){if(this.mh instanceof Kt){if(this.mh.fov===t)return;this.ya=this.mh.fov=t,this.mh.updateProjectionMatrix()}else this.ya=t}get viewSize(){return this.mh instanceof Zt?this.Oa=this.mh.top:this.Oa}set viewSize(t){if(this.mh instanceof Zt){if(this.mh.top===t)return;this.Oa=t;const e=this.engine.screen.width/this.engine.screen.height,i=this.Oa;this.mh.left=-i*e,this.mh.right=i*e,this.mh.top=i,this.mh.bottom=-i,this.mh.updateProjectionMatrix()}else this.Oa=t}get zoom(){return this.mh?this.Pa=this.mh.zoom:this.Pa}set zoom(t){const e=this.mh;if(e){if(e.zoom===t)return;this.Pa=e.zoom=t,e.updateProjectionMatrix()}else this.Pa=t}get near(){return this.mh?this._a=this.mh.near:this._a}set near(t){const e=this.mh;if(e){if(e.near===t)return;this._a=e.near=t,e.updateProjectionMatrix()}else this._a=t}get far(){return this.mh?this.ba=this.mh.far:this.ba}set far(t){const e=this.mh;if(e){if(e.far===t)return;this.ba=e.far=t,e.updateProjectionMatrix()}else this.ba=t}get priority(){return this.Dt}set priority(t){this.Dt=t,this.mh&&this.h.changeCameraPriority(this,t)}get backgroundColor(){return this.io}set backgroundColor(t){null===t?this.io=null:t instanceof Rt?this.io instanceof Rt?this.io.copy(t):this.io=t.clone():this.io=t,this.mh&&this.h.changeCameraBackgroundColor(this,t)}get threeCamera(){return this.mh}static removeCameraFromDuckPool(t){}}class ae extends ee{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.requiredComponents=[oe],this.Ur=null,this.kr=new zt,this.Or=20,this.br=1,this.Lr=!1,this.jr=!1,this.yr=6,this.qr=new F}start(){if(this.Ur){const t=this.qr.copy(this.Ur.transform.position);t.z+=this.Or,this.transform.position.copy(t)}}update(){const t=this.qr.copy(this.Ur.transform.position);t.z+=this.Or,t.x+=this.kr.x,t.y+=this.kr.y;const e=this.transform;if(this.jr){const i=this.engine.time.deltaTime,s=this.yr,r=T(e.position.x,t.x,s,i),h=T(e.position.y,t.y,s,i),n=T(e.position.z,t.z,s,i);e.position.set(r,h,n)}else e.position.copy(t);this.Lr&&(e.localPosition.x=Math.round(e.localPosition.x/this.br)*this.br,e.localPosition.y=Math.round(e.localPosition.y/this.br)*this.br)}setTrackTarget(t){this.Ur=t}get targetOffset(){return this.kr}set targetOffset(t){this.kr.copy(t)}get cameraDistanceOffset(){return this.Or}set cameraDistanceOffset(t){this.Or=t}get pixelPerfectUnit(){return this.br}set pixelPerfectUnit(t){this.br=t}get pixelPerfect(){return this.Lr}set pixelPerfect(t){this.Lr=t}get smoothTrack(){return this.jr}set smoothTrack(t){this.jr=t}get smoothLambda(){return this.yr}set smoothLambda(t){this.yr=t}}class le{}le.defaultSpriteSrc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAA8SURBVDhP7dEhCgAxDADB+/k9Lh8rDCtq6yo6JrAhKt9s/k2JEjceNGlPiRI3HjRpT4kS7w81SpQ4PJhZxl3jEH3ZDWcAAAAASUVORK5CYII=";class ce extends ut{constructor(t=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable","false"),this.addEventListener("removed",(()=>{this.traverse((t=>{t instanceof ce&&t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)}))}))}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this}}new F,new j,new F,new L,new L;class ue{constructor(t=0,e=0,i=0,s=new Rt,r=null){this.Xo=t,this.Yo=e,this.Sl=i,this.oc=(new Rt).copy(s),this.Xl=r}get onChange(){return this.Xl}set onChange(t){this.Xl=t}get offsetX(){return this.Xo}set offsetX(t){var e;this.Xo=t,null===(e=this.Xl)||void 0===e||e.call(this)}get offsetY(){return this.Yo}set offsetY(t){var e;this.Yo=t,null===(e=this.Xl)||void 0===e||e.call(this)}get blur(){return this.Sl}set blur(t){var e;this.Sl=t,null===(e=this.Xl)||void 0===e||e.call(this)}get color(){return this.oc}set color(t){var e;this.oc.copy(t),null===(e=this.Xl)||void 0===e||e.call(this)}copy(t){var e;this.Xo=t.offsetX,this.Yo=t.offsetY,this.Sl=t.blur,this.oc.copy(t.color),null===(e=this.Xl)||void 0===e||e.call(this)}clone(){return new ue(this.Xo,this.Yo,this.Sl,this.oc.clone())}toString(){return"drop-shadow("+this.Xo+"px "+this.Yo+"px "+this.Sl+"px "+this.oc.toString()+")"}}class de{constructor(t=null){this.Sl=0,this.td=1,this.sd=1,this.hd=null,this.rd=0,this.nd=0,this.od=0,this.dd=1,this.ud=0,this.Xl=t}copy(t){var e;this.Sl=t.Sl,this.td=t.td,this.sd=t.sd,!this.hd&&t.hd?(this.hd=new ue(void 0,void 0,void 0,void 0,this.Xl),this.hd.copy(t.hd)):this.hd&&t.hd&&this.hd.copy(t.hd),this.rd=t.rd,this.nd=t.nd,this.od=t.od,this.dd=t.dd,this.ud=t.ud,null===(e=this.Xl)||void 0===e||e.call(this)}clone(){const t=new de;return t.copy(this),t}get blur(){return this.Sl}set blur(t){var e;this.Sl=t,null===(e=this.Xl)||void 0===e||e.call(this)}get brightness(){return this.td}set brightness(t){var e;this.td=t,null===(e=this.Xl)||void 0===e||e.call(this)}get contrast(){return this.sd}set contrast(t){var e;this.sd=t,null===(e=this.Xl)||void 0===e||e.call(this)}get dropShadow(){return this.hd}set dropShadow(t){t?(this.hd||(this.hd=new ue(void 0,void 0,void 0,void 0,this.Xl)),this.hd.copy(t)):this.hd&&(this.hd.onChange=null,this.hd=null)}get grayscale(){return this.rd}set grayscale(t){var e;this.rd=t,null===(e=this.Xl)||void 0===e||e.call(this)}get hueRotate(){return this.nd}set hueRotate(t){var e;this.nd=t,null===(e=this.Xl)||void 0===e||e.call(this)}get invert(){return this.od}set invert(t){var e;this.od=t,null===(e=this.Xl)||void 0===e||e.call(this)}get saturate(){return this.dd}set saturate(t){var e;this.dd=t,null===(e=this.Xl)||void 0===e||e.call(this)}get sepia(){return this.ud}set sepia(t){var e;this.ud=t,null===(e=this.Xl)||void 0===e||e.call(this)}toString(){let t="";return 0!==this.Sl&&(t+="blur("+this.Sl+"px) "),1!==this.td&&(t+="brightness("+this.td+") "),1!==this.sd&&(t+="contrast("+this.sd+") "),0!==this.rd&&(t+="grayscale("+this.rd+") "),0!==this.nd&&(t+="hue-rotate("+this.nd+"deg) "),0!==this.od&&(t+="invert("+this.od+") "),1!==this.dd&&(t+="saturate("+this.dd+") "),0!==this.ud&&(t+="sepia("+this.ud+") "),this.hd&&(t+=this.hd.toString()),t}}class me extends ee{constructor(){super(...arguments),this.css3DObject=null,this.htmlElement=null,this.xa=new zt,this.sn=.1,this.Zr=!0,this.hn=()=>{this.htmlElement&&(this.htmlElement.style.filter=this.aa.toString())},this.aa=new de(this.hn),this.rl=!1}start(){this.rl=!0,this.renderInitialize()}onDestroy(){this.css3DObject&&(this.transform.dequeueRenderAttachedObject3D(this.css3DObject),this.transform.unsafeGetObject3D().remove(this.css3DObject),this.css3DObject=null,this.htmlElement=null)}onEnable(){this.css3DObject&&(this.css3DObject.visible=!0,this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}onDisable(){this.css3DObject&&(this.css3DObject.visible=!1,this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}onWorldMatrixUpdated(){this.css3DObject&&(wt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}renderInitialize(){throw new Error("Yon can't Use CssRenderer Directly, use Derived Class e.g. CssSpriteRenderer")}initializeBaseComponents(t){const e=this.htmlElement;if(!e)throw new Error("htmlElement is null");let i=!1;return t?(this.css3DObject&&this.transform.unsafeGetObject3D().remove(this.css3DObject),this.css3DObject=new ce(e),i=!0):this.css3DObject?this.css3DObject.element=e:(this.css3DObject=new ce(e),i=!0),i&&(e.style.pointerEvents=this.pointerEvents?"auto":"none",e.style.filter=this.aa.toString(),this.enabled&&this.gameObject.activeInHierarchy?this.css3DObject.visible=!0:this.css3DObject.visible=!1),this.updateViewScale(!1),this.updateCenterOffset(!1),this.transform.unsafeGetObject3D().add(this.css3DObject),this.css3DObject}updateCenterOffset(t){throw new Error("Yon can't Use CssRenderer Directly, use Derived Class e.g. CssSpriteRenderer")}updateViewScale(t){throw new Error("Yon can't Use CssRenderer Directly, use Derived Class e.g. CssSpriteRenderer")}get centerOffset(){return this.xa}set centerOffset(t){this.xa.copy(t),this.updateCenterOffset(!0)}get viewScale(){return this.sn}set viewScale(t){this.sn=t,this.updateViewScale(!0)}get pointerEvents(){return this.Zr}set pointerEvents(t){this.Zr=t,this.htmlElement&&(this.htmlElement.style.pointerEvents=t?"auto":"none")}get filter(){return this.aa}get readyToDraw(){return this.rl}get htmlElementEventHandler(){return this.htmlElement}}(he=re||(re={})).Auto="auto",he.CrispEdges="crisp-edges",he.Pixelated="pixelated";class pe extends me{constructor(){super(...arguments),this.Ha=0,this.Xa=0,this.Ya=!1,this.Ea=!1,this.$a=1,this.en=re.Pixelated,this.Za=null}renderInitialize(){this.Za?this.Za():this.asyncSetImageFromPath(le.defaultSpriteSrc)}updateCenterOffset(t){this.css3DObject&&(this.css3DObject.position.set(this.Ha*this.centerOffset.x,this.Xa*this.centerOffset.y,0),t&&(wt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject)))}updateViewScale(t){if(!this.css3DObject)return;const e=this.viewScale,i=this.htmlElement;i.style.width=this.Ha/this.viewScale+"px",i.style.height=this.Xa/this.viewScale+"px";const s=this.Ya?-1:1,r=this.Ea?-1:1;this.css3DObject.scale.set(e*s,e*r,e),t&&(wt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get image(){return this.htmlElement}asyncSetImageFromPath(t,e){var i;if(!this.readyToDraw)return void(this.Za=()=>this.asyncSetImageFromPath(t,e));const s=null!==(i=this.htmlElement)&&void 0!==i?i:new Image;s.src=t;const r=t=>{this.exists&&(s.removeEventListener("load",r),this.setImage(s),null==e||e())};s.addEventListener("load",r)}setImage(t){if(!t.complete)throw new Error(`Image {${t.src}} is not loaded.`);if(this.htmlElement=t,!this.readyToDraw)return void(this.Za=()=>this.setImage(t));t.alt=this.gameObject.name+"_sprite",t.style.imageRendering=this.en,0===this.Ha&&(this.Ha=.1*t.naturalWidth),0===this.Xa&&(this.Xa=.1*t.naturalHeight),t.style.width=this.Ha/this.viewScale+"px",t.style.height=this.Xa/this.viewScale+"px",t.style.opacity=this.$a.toString();const e=this.initializeBaseComponents(!1);wt.updateRawObject3DWorldMatrixRecursively(e),this.transform.enqueueRenderAttachedObject3D(e)}get imageWidth(){return this.Ha}set imageWidth(t){this.Ha=t,this.htmlElement&&(this.htmlElement.style.width=t/this.viewScale+"px"),this.updateCenterOffset(!0)}get imageHeight(){return this.Xa}set imageHeight(t){this.Xa=t,this.htmlElement&&(this.htmlElement.style.height=t/this.viewScale+"px"),this.updateCenterOffset(!0)}get imageFlipX(){return this.Ya}set imageFlipX(t){this.Ya=t,this.css3DObject&&(this.Ya?0<this.css3DObject.scale.x&&(this.css3DObject.scale.x*=-1):this.css3DObject.scale.x<0&&(this.css3DObject.scale.x*=-1),wt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get imageFlipY(){return this.Ea}set imageFlipY(t){this.Ea=t,this.css3DObject&&(this.Ea?0<this.css3DObject.scale.y&&(this.css3DObject.scale.y*=-1):this.css3DObject.scale.y<0&&(this.css3DObject.scale.y*=-1),wt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}get opacity(){return this.$a}set opacity(t){this.$a=t,this.htmlElement&&(this.htmlElement.style.opacity=this.$a.toString())}get imageRenderingMode(){return this.en}set imageRenderingMode(t){this.en=t,this.htmlElement&&(this.htmlElement.style.imageRendering=this.en)}}class ge{constructor(t,e=1,i=1){if(!t.complete)throw new Error(`Image {${t.src}} is not loaded.`);this.lc=t,this.Aa=i,this.wa=e}get htmlImageElement(){return this.lc}get columnCount(){return this.wa}get rowCount(){return this.Aa}}class fe extends me{constructor(){super(...arguments),this.wa=10,this.Aa=10,this.Kr=1,this.Nr=1,this.Br=16,this.Gr=16,this.Qr=null,this.en=re.Pixelated,this.Sr=[]}renderInitialize(){this.uc();const t=this.Sr;for(let e=0;e<t.length;++e)t[e]();this.Sr.length=0}updateCenterOffset(t){if(!this.css3DObject)return;const e=this.wa*this.Kr,i=this.Aa*this.Nr;this.css3DObject.position.set(e*this.centerOffset.x,i*this.centerOffset.y,0),t&&(wt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}updateViewScale(t){if(!this.css3DObject)return;const e=this.viewScale,i=this.htmlElement,s=this.wa*this.Kr,r=this.Aa*this.Nr;i.style.width=s/e+"px",i.style.height=r/e+"px",this.css3DObject.scale.set(e,e,e),t&&(wt.updateRawObject3DWorldMatrixRecursively(this.css3DObject),this.transform.enqueueRenderAttachedObject3D(this.css3DObject))}uc(){const t=this.wa*this.Kr,e=this.Aa*this.Nr,i=this.wa*this.Br,s=this.Aa*this.Gr;this.htmlElement=document.createElement("canvas"),this.htmlElement.width=i,this.htmlElement.height=s,this.htmlElement.style.imageRendering=this.en,this.htmlElement.style.width=t/this.viewScale+"px",this.htmlElement.style.height=e/this.viewScale+"px";const r=this.initializeBaseComponents(!1);wt.updateRawObject3DWorldMatrixRecursively(r),this.transform.enqueueRenderAttachedObject3D(r)}drawTile(t,e,i,s){if(!this.readyToDraw)return void this.Sr.push((()=>this.drawTile(t,e,i,s)));const r=this.htmlElement.getContext("2d"),h=this.Qr[i];if(1===h.rowCount&&1===h.columnCount)r.drawImage(h.htmlImageElement,0,0,this.Br,this.Gr,t*this.Br,e*this.Gr,this.Br,this.Gr);else{if(void 0===s)throw new Error("Atlas index is required.");{const i=Math.floor(s/h.columnCount),n=s%h.columnCount,o=h.htmlImageElement.width/h.columnCount,a=h.htmlImageElement.height/h.rowCount;r.drawImage(h.htmlImageElement,n*o,i*a,o,a,t*this.Br,e*this.Gr,this.Br,this.Gr)}}}drawTileFromTwoDimensionalArray(t,e,i){if(!this.readyToDraw)return void this.Sr.push((()=>this.drawTileFromTwoDimensionalArray(t,e,i)));const s=this.htmlElement.getContext("2d");for(let r=0;r<t.length;r++){const h=t[r];for(let t=0;t<h.length;t++){const n=h[t];if(null===n)continue;const o=this.Qr[n.i];if(1===o.rowCount&&1===o.columnCount)s.drawImage(o.htmlImageElement,0,0,this.Br,this.Gr,t*this.Br+e*this.Br,r*this.Gr+i*this.Gr,this.Br,this.Gr);else{if(void 0===n.a)throw new Error("Atlas index is required.");{const h=n.a%o.columnCount,a=Math.floor(n.a/o.columnCount),l=o.htmlImageElement.width/o.columnCount,c=o.htmlImageElement.height/o.rowCount;s.drawImage(o.htmlImageElement,h*l,a*c,l,c,t*this.Br+e*this.Br,r*this.Gr+i*this.Gr,this.Br,this.Gr)}}}}}clearTile(t,e){this.readyToDraw?this.htmlElement.getContext("2d").clearRect(t*this.Br,e*this.Gr,this.Br,this.Gr):this.Sr.push((()=>this.clearTile(t,e)))}set imageSources(t){if(this.readyToDraw){this.Qr=t;for(let e=0;e<t.length;++e)if(!t[e].htmlImageElement.complete)throw new Error(`Image ${t[e].htmlImageElement.src} is not loaded.`)}else this.Sr.push((()=>this.imageSources=t))}get columnCount(){return this.wa}set columnCount(t){if(this.wa=t,this.htmlElement){const t=this.wa*this.Kr,e=this.wa*this.Br;this.htmlElement.width=e,this.htmlElement.style.width=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get rowCount(){return this.Aa}set rowCount(t){if(this.Aa=t,this.htmlElement){const t=this.Aa*this.Nr,e=this.Aa*this.Gr;this.htmlElement.height=e,this.htmlElement.style.height=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get gridCellWidth(){return this.Kr}set gridCellWidth(t){if(this.Kr=t,this.htmlElement){const t=this.wa*this.Kr;this.htmlElement.style.width=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get gridCellHeight(){return this.Nr}set gridCellHeight(t){if(this.Nr=t,this.htmlElement){const t=this.Aa*this.Nr;this.htmlElement.style.height=t/this.viewScale+"px",this.updateCenterOffset(!0)}}get tileResolutionX(){return this.Br}set tileResolutionX(t){if(this.Br=t,this.htmlElement){const t=this.wa*this.Br;this.htmlElement.width=t}}get tileResolutionY(){return this.Gr}set tileResolutionY(t){if(this.Gr=t,this.htmlElement){const t=this.Aa*this.Gr;this.htmlElement.height=t}}get gridCenter(){const t=this.columnCount%2==1?0:this.Kr/2,e=this.rowCount%2==1?0:this.Nr/2;return new zt(this.transform.position.x+t,this.transform.position.y+e)}get gridCenterX(){return this.transform.position.x+(this.columnCount%2==1?0:this.Kr/2)}get gridCenterY(){return this.transform.position.y+(this.rowCount%2==1?0:this.Nr/2)}get imageRenderingMode(){return this.en}set imageRenderingMode(t){this.en=t,this.htmlElement&&(this.htmlElement.style.imageRendering=this.en)}}class ye extends ee{constructor(){super(...arguments),this.Fr=new Map,this.Xr=new Map,this.Yr=16,this.Kr=1,this.Nr=1,this.Br=16,this.Gr=16,this.Jr=1.001,this.Qr=null,this.Zr=!0,this.sn=.1,this.en=re.Pixelated,this.hn=()=>{this.Fr.forEach(((t,e)=>{t.filter.copy(this.aa)}))},this.aa=new de(this.hn),this.Sr=[],this.zr=!1}start(){this.zr=!0;const t=this.Sr;for(let e=0;e<t.length;++e)t[e]();this.Sr.length=0}rn(){this.Fr.forEach(((t,e)=>{const i=this.nn(e)*this.Yr*this.Kr,s=this.on(e)*this.Yr*this.Nr;t.gameObject.transform.localPosition.set(i,s,0)}))}nn(t){return parseInt(t.substring(0,t.indexOf("_")))}on(t){return parseInt(t.substring(t.indexOf("_")+1))}ln(t,e){return`${t}_${e}`}cn(t,e,i,s){const r=i-t*this.Yr+this.Yr/2,h=s-e*this.Yr+this.Yr/2;return new zt(r,h)}an(t,e){const i=this.ln(t,e);let s=this.Fr.get(i);if(void 0===s){const r=new Vt;this.gameObject.addChildFromBuilder(this.engine.instantiater.buildGameObject("css_tilemap_renderer_"+t+"_"+e,new F(t*this.Yr*this.Kr,e*this.Yr*this.Nr,0),void 0,(new F).setScalar(this.Jr)).withComponent(fe,(t=>{this.Qr&&(t.imageSources=this.Qr),t.gridCellWidth=this.Kr,t.gridCellHeight=this.Nr,t.tileResolutionX=this.Br,t.tileResolutionY=this.Gr,t.rowCount=this.Yr,t.columnCount=this.Yr,t.pointerEvents=this.Zr,t.viewScale=this.sn,t.filter.copy(this.aa)})).getComponent(fe,r)),s=r.ref,this.Fr.set(i,s)}return s}un(t,e){const i=this.ln(t,e),s=this.Fr.get(i);return void 0===s?null:s}drawTile(t,e,i,s){if(!this.zr)return void this.Sr.push((()=>{this.drawTile(t,e,i,s)}));const r=Math.floor((t+this.Yr/2)/this.Yr),h=Math.floor((e+this.Yr/2)/this.Yr),n=this.an(r,h),o=this.cn(r,h,t,e),a=this.chunkSize%2==0?0:-.5,l=this.chunkSize%2==0?0:.5,c=o.x+a,u=this.Yr-o.y-1+l;n.drawTile(c,u,i,s);const d=this.ln(r,h),m=this.Xr.get(d);void 0===m?this.Xr.set(d,new Set([`${c}_${u}`])):m.add(`${c}_${u}`)}drawTileFromTwoDimensionalArray(t,e,i){if(this.zr)for(let s=0;s<t.length;s++)for(let r=0;r<t[s].length;r++)null!==t[s][r]&&this.drawTile(r+e,t.length-s+i-1,t[s][r].i,t[s][r].a);else this.Sr.push((()=>{this.drawTileFromTwoDimensionalArray(t,e,i)}))}clearTile(t,e){if(!this.zr)return void this.Sr.push((()=>{this.clearTile(t,e)}));const i=Math.floor((t+this.Yr/2)/this.Yr),s=Math.floor((e+this.Yr/2)/this.Yr),r=this.un(i,s);if(null===r)return;const h=this.cn(i,s,t,e),n=this.chunkSize%2==0?0:-.5,o=this.chunkSize%2==0?0:.5,a=h.x+n,l=this.Yr-h.y-1+o;r.clearTile(a,l);const c=this.ln(i,s),u=this.Xr.get(c);void 0!==u&&(u.delete(`${a}_${l}`),0===u.size&&(this.Xr.delete(c),this.Fr.delete(c),r.destroy()))}get chunkSize(){return this.Yr}set chunkSize(t){this.Yr=t,this.rn(),this.Fr.forEach(((t,e)=>{t.rowCount=this.Yr,t.columnCount=this.Yr}))}set imageSources(t){this.zr?(this.Qr=t,this.Fr.forEach(((e,i)=>{e.imageSources=t}))):this.Sr.push((()=>{this.imageSources=t}))}get pointerEvents(){return this.Zr}set pointerEvents(t){this.Zr=t,this.Fr.forEach(((e,i)=>{e.pointerEvents=t}))}get gridCellWidth(){return this.Kr}set gridCellWidth(t){this.Kr!==t&&(this.Kr=t,this.rn(),this.Fr.forEach(((t,e)=>{t.gridCellWidth=this.Kr})))}get gridCellHeight(){return this.Nr}set gridCellHeight(t){this.Nr!==t&&(this.Nr=t,this.rn(),this.Fr.forEach(((t,e)=>{t.gridCellHeight=this.Nr})))}get tileResolutionX(){return this.Br}set tileResolutionX(t){this.Br!==t&&(this.Br=t,this.Fr.forEach(((t,e)=>{t.tileResolutionX=this.Br})))}get tileResolutionY(){return this.Gr}set tileResolutionY(t){this.Gr!==t&&(this.Gr=t,this.Fr.forEach(((t,e)=>{t.tileResolutionY=this.Gr})))}get tilemapScale(){return this.Jr}set tilemapScale(t){this.Jr!==t&&(this.Jr=t,this.Fr.forEach(((t,e)=>{t.gameObject.transform.localScale.setScalar(this.Jr)})))}get gridCenter(){const t=this.Yr%2==1?0:this.Kr/2,e=this.Yr%2==1?0:this.Nr/2;return new zt(this.transform.localPosition.x+t,this.transform.localPosition.y+e)}get gridCenterX(){const t=this.Yr%2==1?0:this.Kr/2;return this.transform.localPosition.x+t}get gridCenterY(){const t=this.Yr%2==1?0:this.Nr/2;return this.transform.localPosition.y+t}get viewScale(){return this.sn}set viewScale(t){this.sn=t,this.Fr.forEach(((t,e)=>{t.viewScale=this.sn}))}get filter(){return this.aa}get imageRenderingMode(){return this.en}set imageRenderingMode(t){this.en=t,this.Fr.forEach(((e,i)=>{e.imageRenderingMode=t}))}}class xe{static loadImageFromPath(t){return new Promise(((e,i)=>{const s=new Image;s.onload=()=>{e(s)},s.onerror=()=>{i(new Error(`Failed to load image "${t}".`))},s.src=t}))}static loadImagesFromPath(t){return Promise.all(t.map((t=>xe.loadImageFromPath(t))))}static loadImage(t){return new Promise(((e,i)=>{t.onload=()=>{e(t)},t.onerror=()=>{i(new Error("Failed to load image."))}}))}static loadImages(t){return Promise.all(t.map((t=>xe.loadImage(t))))}}class ve{constructor(t,e){this.nh=t,this.ah=e,this.eu=0,this.ru=0,this.ou=0,this.uu=null,this.lu=!0}calculateFCost(){this.ou=this.eu+this.ru}equals(t){return this.nh===t.nh&&this.ah===t.ah}get x(){return this.nh}get y(){return this.ah}get gCost(){return this.eu}set gCost(t){this.eu=t}get hCost(){return this.ru}set hCost(t){this.ru=t}get fCost(){return this.ou}set fCost(t){this.ou=t}get isWalkable(){return this.lu}set isWalkable(t){this.lu=t}get previousNode(){return this.uu}set previousNode(t){this.uu=t}}class we{constructor(t,e=.5,i=.5,s=1e3){var r;this.pr=null!==(r=null==t?void 0:t.slice())&&void 0!==r?r:[],this.wl=e,this.Nl=i,this.Pl=s}addCollideMap(t){this.pr.push(t)}removeCollideMap(t){const e=this.pr.indexOf(t);e>=0&&this.pr.splice(e,1)}removeAllCollideMaps(){this.pr.length=0}findPath(t,e){const i=new ve(t.x,t.y),s=new ve(e.x,e.y);if(this.Ar(i.x,i.y))return null;if(this.Ar(s.x,s.y))return null;const r=[],h=[];i.gCost=0,i.hCost=this._l(i,s),i.calculateFCost(),r.push(i);let n=0;for(;r.length>0&&n<this.Pl;){n++;const t=this.Cl(r);if(t.equals(s))return this.Ml(t);r.splice(r.indexOf(t),1),h.push(t);const e=this.gl(t);for(let i=0;i<e.length;++i){const n=e[i];if(void 0!==h.find((t=>t.equals(n))))continue;if(n.gCost=Number.MAX_VALUE,n.calculateFCost(),n.previousNode=null,this.Ar(n.x,n.y)){h.push(n);continue}const o=t.gCost+this._l(t,n);o<n.gCost&&(n.previousNode=t,n.gCost=o,n.hCost=this._l(n,s),n.calculateFCost(),void 0===r.find((t=>t.equals(n)))&&r.push(n))}}return null}gl(t){const e=[];return e.push(new ve(t.x,t.y-1)),e.push(new ve(t.x+1,t.y)),e.push(new ve(t.x,t.y+1)),e.push(new ve(t.x-1,t.y)),e}Ml(t){const e=[];let i=t;for(;i.previousNode;)e.push(new zt(i.x,i.y)),i=i.previousNode;return e.push(new zt(i.x,i.y)),e.reverse()}_l(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)}Cl(t){let e=t[0];for(let i=1;i<t.length;++i)t[i].fCost<e.fCost&&(e=t[i]);return e}Ar(t,e){const i=this.pr;for(let s=0;s<i.length;++s){const r=i[s];if(r.checkCollision(t*r.gridCellWidth+r.gridCenterX,e*r.gridCellHeight+r.gridCenterY,this.wl,this.Nl))return!0}return!1}}!function(t){t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right"}(ne||(ne={}));class _e extends ee{constructor(){super(...arguments),this.Do=ne.Down,this.xo=!1}get direction(){return this.Do}set direction(t){this.Do=t}get isMoving(){return this.xo}set isMoving(t){this.xo=t}}class Me extends _e{constructor(){super(...arguments),this.disallowMultipleComponent=!0,this.Mh=8,this.Ph=1,this.Th=1,this.pr=[],this.Ih=.5,this.yh=new zt,this.Eh=new zt,this.Gh=new zt,this.Lh=new zt,this.Rh=new l,this.Uh=new l,this.mr=null,this.gr=null,this.Hh=!1,this.Kh=null,this.Oh=0,this.Wh=null,this.Fh=new zt,this.qh=!0,this.Bh=new zt,this.Jh=new zt,this.Nh=-1,this.Qh=new zt,this.Xh=.3,this.vr=t=>{if(0!==t.button)return;this.Hh=!1;const e=this.engine.time.unscaledTime;e-this.Nh<this.Xh?this.Qh.equals(t.gridPosition)&&(this.Yh(t),this.Nh=-1):(this.Nh=e,this.Qh.copy(t.gridPosition))}}start(){this.gr=new we(this.pr,this.Th*this.Ih,this.Ph*this.Ih);const t=this.transform,e=t.position;e.x=this.yh.x+this.Lh.x*this.Th,e.y=this.yh.y+this.Lh.y*this.Ph,this.Eh.set(t.localPosition.x,t.localPosition.y);const i=t.parent;i&&this.Fh.set(i.position.x,i.position.y)}update(){var t;null===(t=this.Wh)||void 0===t||t.call(this),this.qh&&this.Zh(),this.$h(),this.Dr()}Zh(){if(this.isMoving)return void this.Mr();const t=this.engine.input.map,e=this.Eh;if(t.get("w")||t.get("ArrowUp")){if(this.direction=ne.Up,this.Ar(e.x,e.y+this.Ph))return;this.Gh.set(e.x,e.y+this.Ph),this.Vr(),this.isMoving=!0}else if(t.get("s")||t.get("ArrowDown")){if(this.direction=ne.Down,this.Ar(e.x,e.y-this.Ph))return;this.Gh.set(e.x,e.y-this.Ph),this.Vr(),this.isMoving=!0}else if(t.get("a")||t.get("ArrowLeft")){if(this.direction=ne.Left,this.Ar(e.x-this.Th,e.y))return;this.Gh.set(e.x-this.Th,e.y),this.Vr(),this.isMoving=!0}else if(t.get("d")||t.get("ArrowRight")){if(this.direction=ne.Right,this.Ar(e.x+this.Th,e.y))return;this.Gh.set(e.x+this.Th,e.y),this.Vr(),this.isMoving=!0}}Tr(t){const e=this.engine.input.map;return e.get("w")||e.get("ArrowUp")?(this.direction=ne.Up,!this.Ar(t.x,t.y+this.Ph)&&(this.Gh.set(t.x,t.y+this.Ph),this.Vr(),!0)):e.get("s")||e.get("ArrowDown")?(this.direction=ne.Down,!this.Ar(t.x,t.y-this.Ph)&&(this.Gh.set(t.x,t.y-this.Ph),this.Vr(),!0)):e.get("a")||e.get("ArrowLeft")?(this.direction=ne.Left,!this.Ar(t.x-this.Th,t.y)&&(this.Gh.set(t.x-this.Th,t.y),this.Vr(),!0)):!(!e.get("d")&&!e.get("ArrowRight")||(this.direction=ne.Right,this.Ar(t.x+this.Th,t.y)||(this.Gh.set(t.x+this.Th,t.y),this.Vr(),0)))}Vr(){this.Rh.invoke(Math.floor((this.Gh.x-this.yh.x)/this.Th),Math.floor((this.Gh.y-this.yh.y)/this.Ph))}Ir(){this.Uh.invoke(Math.floor((this.Eh.x-this.yh.x)/this.Th),Math.floor((this.Eh.y-this.yh.y)/this.Ph))}Mr(){const t=this.engine.input.map;(t.get("w")||t.get("ArrowUp")||t.get("s")||t.get("ArrowDown")||t.get("a")||t.get("ArrowLeft")||t.get("d")||t.get("ArrowRight"))&&(this.Hh=!1)}$h(){if(!this.Hh)return;const t=this.transform,e=this.Bh.set(t.localPosition.x,t.localPosition.y),i=this.Kh[this.Oh];if(i.distanceTo(e)<this.Mh*this.engine.time.deltaTime){if(this.Oh++,this.Oh>=this.Kh.length)return void(this.Hh=!1);this.Ir()}if(this.Ar(i.x,i.y))return void(this.Hh=!1);if(this.Gh.equals(this.Kh[this.Oh]))return;this.Gh.copy(this.Kh[this.Oh]),this.Vr();const s=this.Kh[this.Oh-1].x,r=this.Kh[this.Oh-1].y,h=this.Kh[this.Oh].x,n=this.Kh[this.Oh].y;r<n?this.direction=ne.Up:r>n?this.direction=ne.Down:s<h?this.direction=ne.Right:s>h&&(this.direction=ne.Left),this.isMoving=!0}Dr(){if(!this.isMoving)return;const t=this.transform,e=this.Bh.set(t.localPosition.x,t.localPosition.y);let i=e.distanceTo(this.Gh);const s=this.Mh*this.engine.time.deltaTime;i<s&&this.Tr(this.Gh)&&(i=e.distanceTo(this.Gh),this.Ir());const r=this.Jh.copy(this.Gh).sub(e).normalize();i<s?(this.isMoving=!1,this.Eh.copy(this.Gh),t.localPosition.x=this.Eh.x,t.localPosition.y=this.Eh.y,this.Ir()):(r.multiplyScalar(s),this.gameObject.transform.localPosition.x+=r.x,this.gameObject.transform.localPosition.y+=r.y)}Ar(t,e){t+=this.Fh.x,e+=this.Fh.y;const i=this.pr;for(let s=0;s<i.length;++s)if(i[s].checkCollision(t,e,this.Ih,this.Ih))return!0;return!1}Yh(t){if(this.Hh)return this.Hh=!1,void(this.Wh=()=>{this.tryStartPathfind(t.gridPosition)});this.Wh=()=>{this.tryStartPathfind(t.gridPosition)}}tryStartPathfind(t){if(this.Hh)return!1;this.Wh=null;const e=this.Kh=this.gr.findPath(this.positionInGrid,t);if(!e||e.length<=1)return!1;for(let t=0;t<e.length;++t){const i=e[t];i.x=i.x*this.Th+this.yh.x,i.y=i.y*this.Ph+this.yh.y}return this.Oh=1,this.isMoving=!0,this.Hh=!0,!0}cancelPathfind(){this.Hh=!1}get onMoveToTarget(){return this.Rh}get onMovedToTarget(){return this.Uh}teleport(t){this.isMoving=!1,this.Hh=!1,this.Eh.copy(t).multiplyScalar(this.Th).add(this.yh),this.Gh.copy(this.Eh),this.transform.localPosition.x=this.Eh.x,this.transform.localPosition.y=this.Eh.y,this.Vr(),this.Ir()}get speed(){return this.Mh}set speed(t){this.Mh=t}get gridCenter(){return this.yh}set gridCenter(t){this.yh.copy(t)}get gridCellHeight(){return this.Ph}set gridCellHeight(t){this.Ph=t}get gridCellWidth(){return this.Th}set gridCellWidth(t){this.Th=t}set initPosition(t){this.Lh.copy(t)}set gridPointer(t){this.mr&&this.mr.onPointerDown.removeListener(this.vr),this.mr=t,this.mr&&this.mr.onPointerDown.addListener(this.vr)}get gridPointer(){return this.mr}addCollideMap(t){var e;this.pr.push(t),null===(e=this.gr)||void 0===e||e.addCollideMap(t)}removeCollideMap(t){var e;const i=this.pr.indexOf(t);i>=0&&(this.pr.splice(i,1),null===(e=this.gr)||void 0===e||e.removeCollideMap(t))}removeAllCollideMaps(){var t;this.pr.length=0,null===(t=this.gr)||void 0===t||t.removeAllCollideMaps()}setGridInfoFromCollideMap(t){this.Th=t.gridCellWidth,this.Ph=t.gridCellHeight,this.yh.set(t.gridCenterX,t.gridCenterY)}get positionInGrid(){return new zt(Math.floor((this.transform.localPosition.x-this.yh.x)/this.Th),Math.floor((this.transform.localPosition.y-this.yh.y)/this.Ph))}get receiveKeyboardInput(){return this.qh}set receiveKeyboardInput(t){this.qh=t}}class Ce extends ee{executionOrder=1e3;loadComponent=null;waitComponent=null;_loadComponent=null;_waitComponent=null;load=(t,e)=>{e()};awake(){this.loadComponent&&this.waitComponent&&(this._loadComponent=this.gameObject.getComponent(this.loadComponent),this._waitComponent=this.gameObject.getComponent(this.waitComponent),this._loadComponent&&this._waitComponent&&(this._waitComponent.enabled=!1,this.load(this._loadComponent,(()=>{this._waitComponent.enabled=!0}))))}}class be{getTileSprite(t){const e=this.tiles;return e[Math.floor(t.next()*e.length)]}matchCondition(t,e,i){return t>=this.minHeight&&e>=this.minMoisture&&i>=this.minHeat}}const Ee=new class extends be{tiles=[{i:0,a:15}];minHeight=0;minMoisture=0;minHeat=.9},Se=new class extends be{tiles=[{i:0,a:22}];minHeight=.1;minMoisture=.2;minHeat=.1},Oe=new class extends be{tiles=[{i:0,a:54}];minHeight=.7;minMoisture=0;minHeat=0};class ke{_a;constructor(t){this._a=t}next(){let t=this._a+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296}}class ze{seed;frequency;amplitude;constructor(t,e,i){this.seed=t,this.frequency=e,this.amplitude=i}}class De{static _perm=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180,151];static generate(t,e,i,s,r){const h=new Array(t);for(let i=0;i<t;i++){h[i]=new Array(e);for(let t=0;t<e;t++)h[i][t]=0}for(let n=0;n<t;++n)for(let t=0;t<e;++t){const e=n*i+r.x,o=t*i+r.y;let a=0;for(let i=0;i<s.length;++i){const r=s[i];h[n][t]+=r.amplitude*(this.perlinNoise(e*r.frequency+r.seed,o*r.frequency+r.seed)+.5),a+=r.amplitude}h[n][t]/=a}return h}static floorToInt(t){return t>0?Math.floor(t):Math.ceil(t)}static fade(t){return t*t*t*(t*(6*t-15)+10)}static grad(t,e,i){return(0==(1&t)?e:-e)+(0==(2&t)?i:-i)}static lerp(t,e,i){return e+t*(i-e)}static perlinNoise(t,e){const i=255&De.floorToInt(t),s=255&De.floorToInt(e);t-=Math.floor(t),e-=Math.floor(e);const r=this.fade(t),h=this.fade(e),n=De._perm[i]+s&255,o=De._perm[s+1]+s&255;return this.lerp(h,this.lerp(r,this.grad(De._perm[n],t,e),this.grad(De._perm[o],t-1,e)),this.lerp(r,this.grad(De._perm[n+1],t,e-1),this.grad(De._perm[o+1],t-1,e-1)))}}class Ae{biome;constructor(t){this.biome=t}getDiffValue(t,e,i){const s=this.biome;return t-s.minHeight+(e-s.minMoisture)+(i-s.minHeat)}}class Re{tilemap;biomes=[Ee,Se,Oe];scale=1;heightWaves=[new ze(56,.05,1),new ze(199.36,.1,.5)];moistureWaves=[new ze(621,.03,1)];heatWaves=[new ze(318.6,.04,1),new ze(329.7,.02,.5)];_mulberry=new ke(0);constructor(t){this.tilemap=t}generateMap(t,e,i){const s=De.generate(t,e,this.scale,this.heightWaves,i),r=De.generate(t,e,this.scale,this.moistureWaves,i),h=De.generate(t,e,this.scale,this.heatWaves,i);for(let n=0;n<t;n++)for(let t=0;t<e;t++){const e=s[n][t],o=r[n][t],a=h[n][t],l=this.getBiome(e,o,a).getTileSprite(this._mulberry);this.tilemap.drawTile(n+i.x,t+i.y,l.i,l.a)}}getBiome(t,e,i){const s=[],r=this.biomes;for(let h=0;h<r.length;++h){const n=r[h];n.matchCondition(t,e,i)&&s.push(new Ae(n))}let h=0,n=null;for(let r=0;r<s.length;++r){const o=s[r];(null==n||o.getDiffValue(t,e,i)<h)&&(n=o.biome,h=o.getDiffValue(t,e,i))}return null==n&&(n=r[0]),n}}class Pe{generator;_chunkSize;_renderer;_loadedChunks=new Set;constructor(t,e=15){this.generator=new Re(t),this._chunkSize=e,this._renderer=t}vector2ToString(t){return t.x+"_"+t.y}_tempVector2=new zt;generateChunk(t){const e=this._chunkSize,i=this._tempVector2.set(t.x*e-Math.floor(e/2),t.y*e-Math.floor(e/2));this.generator.generateMap(e,e,i)}destroyChunk(t){const e=this._chunkSize,i=this._tempVector2.set(t.x*e-Math.floor(e/2),t.y*e-Math.floor(e/2)),s=this._renderer;for(let t=0;t<e;t++)for(let r=0;r<e;r++)s.clearTile(i.x+r,i.y+t)}loadChunk(t){const e=this.vector2ToString(t);this._loadedChunks.has(e)||(this.generateChunk(t),this._loadedChunks.add(e))}unloadChunk(t){const e=this.vector2ToString(t);this._loadedChunks.has(e)&&(this.destroyChunk(t),this._loadedChunks.delete(e))}unloadAllChunks(){for(const t of this._loadedChunks){const e=t.split("_");this.destroyChunk(new zt(parseInt(e[0]),parseInt(e[1])))}this._loadedChunks.clear()}getChunkIndexFromPosition(t,e){return e??=new zt,e.set(Math.floor((t.x+this._chunkSize/2)/this._chunkSize),Math.floor((t.y+this._chunkSize/2)/this._chunkSize))}}class Te{loadedChunks=new Set;loadChunkQueue=new Set;unloadChunkQueue=new Set}class je extends ee{requiredComponents=[ye];_chunkLoader=null;_chunkSize=15;_playerViewDistance=3;_loadCirclePoints=null;_playerChunkPositions=new Map;_userChunks=new Map;_loadedChunks=new Map;_unloadChunkQueueMaxValue=0;awake(){const t=this.gameObject.getComponent(ye);this._chunkLoader=new Pe(t,this._chunkSize),this._loadCirclePoints=this.computeCirclePoints(this._playerViewDistance),this._unloadChunkQueueMaxValue=3*this._loadCirclePoints.length}computeCirclePoints(t){const e=[];if(t<1)return e;if(1==t)return e.push(new zt(0,0)),e;let i=0,s=t-=1,r=3-(t+t);do{const t=i;for(let r=-i;r<=t;r++)e.push(new zt(r,-s)),e.push(new zt(r,s));const h=i;for(let t=-i;t<=h;t++)e.push(new zt(-s,t)),e.push(new zt(s,t));i+=1,r<0?r+=6+(i<<2):(s-=1,r+=10+(i-s<<2))}while(i<=s);const h=i-1;for(let t=-s;t<=s;t++)for(let s=1-i;s<=h;s++)e.push(new zt(s,t));const n=new Set;for(let t=0;t<e.length;t++){const i=e[t],s=`${i.x},${i.y}`;n.has(s)?(e.splice(t,1),t--):n.add(s)}return e.sort(((t,e)=>{const i=t.length(),s=e.length();return i<s?-1:i>s?1:0})),e}updateChunkEnqueue(t,e){const i=this._loadCirclePoints;let s=this._userChunks.get(t);void 0===s&&(s=new Te,this._userChunks.set(t,s));const r=s.loadChunkQueue,h=s.unloadChunkQueue;r.clear(),h.clear();const n=[];for(const t of s.loadedChunks)n.push(t);for(let t=n.length-1;0<=t;--t)h.add(n[t]);if(e)for(let t=0;t<i.length;t++){const s=i[t],n=s.x+e.x+"_"+(s.y+e.y);h.has(n)?h.delete(n):r.add(n)}}_tempVector2=new zt;*processUpdateChunk(t){const e=this._userChunks.get(t);if(void 0===e)return;const i=e.loadChunkQueue,s=e.unloadChunkQueue,r=e.loadedChunks;let h=performance.now();for(;0<i.size||0<s.size;){if(this._unloadChunkQueueMaxValue<s.size||i.size<=0){const t=s.keys().next().value;s.delete(t),r.delete(t);const e=this._loadedChunks.get(t);if(void 0!==e)if(e-1<=0){this._loadedChunks.delete(t);const e=t.split("_").map(Number);this._chunkLoader.unloadChunk(this._tempVector2.set(e[0],e[1]))}else this._loadedChunks.set(t,e-1)}else{const t=i.keys().next().value;i.delete(t),r.add(t);const e=this._loadedChunks.get(t);if(void 0===e){this._loadedChunks.set(t,1);const e=t.split("_").map(Number);this._chunkLoader.loadChunk(this._tempVector2.set(e[0],e[1]))}else this._loadedChunks.set(t,e+1)}const t=performance.now();10<t-h&&(h=t,yield null)}}_taskQueue=new Set;_runningTasks=new Set;lazyUpdateChunk(t,e){if(this.updateChunkEnqueue(t,e),this._runningTasks.has(t))return;this._taskQueue.add(t);const i=this;this._runningTasks.size<4&&this.startCoroutine(function*(){i._runningTasks.add(t),yield*i.processUpdateChunk(t),i._runningTasks.delete(t)}())}_tempVector1=new zt;updatePlayerPosition(t,e){if(!this.enabled)return;const i=this._chunkLoader.getChunkIndexFromPosition(e,this._tempVector1),s=this._playerChunkPositions.get(t);s?.equals(i)||(this.lazyUpdateChunk(t,i),s?s.copy(i):this._playerChunkPositions.set(t,i.clone()))}removePlayer(t){this._playerChunkPositions.get(t)&&(this.lazyUpdateChunk(t,void 0),this._playerChunkPositions.delete(t))}get generator(){return this._chunkLoader.generator}get chunkSize(){return this._chunkSize}set chunkSize(t){if(this.initialized)throw new Error("Cannot change chunk size after initialization");this._chunkSize=t}get playerViewDistance(){return this._playerViewDistance}set playerViewDistance(t){if(this.initialized)throw new Error("Cannot change player view distance after initialization");this._playerViewDistance=t}}const Fe=t.p+"static/sample_tiles.png",Ie=new class{constructor(t,e=!0){this.S=null;const i=document.createElement("div");i.style.width="100%",i.style.height="100%",i.style.position="relative",t.appendChild(i),t=i,this.C=new kt,this.v=new Pt(t.clientWidth,t.clientHeight),this.K=t,this.h=new At((t=>{if(this.L){const e=this.C.unsafeGetThreeScene();if(t instanceof Rt){const i=this.O;i.r=t.r,i.g=t.g,i.b=t.b,e.background=i}else e.background=t}else if(this.R){const e=this.R.domElement;null===t?e.style.backgroundColor="rgba(0, 0, 0, 0)":t.isTexture?(console.warn("THREE.Texture background is not supported in CSS3DRenderer"),e.style.backgroundColor="rgba(0, 0, 0, 0)"):e.style.backgroundColor="rgba("+255*t.r+","+255*t.g+","+255*t.b+","+t.a+")"}})),this.o=new Nt,this.u=new Et(St.WaitingForStart),this.p=new qt,this.l=new n(this.o),this.m=new Bt,this.I=new Dt,this.T=new bt(this.C,this.h,this.o,this.u,this.v,this.p,this.l,this.m,this.I,t),this.j=null,this.D=!1,this.A=e,this.F=this.resizeFramebuffer.bind(this),e&&window.addEventListener("resize",this.F),this.M=this.W.bind(this)}resizeFramebuffer(){const t=this.K.clientWidth,e=this.K.clientHeight;t===this.v.width&&e===this.v.height||(this.v.resize(t,e),this.R&&(this.R.setSize(t,e),this.R.domElement.style.width="100%",this.R.domElement.style.height="100%"),this.L&&(this.L.setSize(t,e),this._.style.width="100%",this._.style.height="100%"))}run(t,e){var i;if(this.D)throw new Error("Game is disposed.");if(this.u.kind!==St.WaitingForStart)throw new Error("Game is already running.");this.u.kind=St.Initializing,this.o.start();const s=new t(this.T,e),r=s.run();if(this.S=s.getGameSettingObject(),this.T.applyGameSetting(this.S),this.S.render.webGLRendererLoader)if(void 0===this.S.render.webGLRendererInitilizer)console.warn("webGLRendererLoader is specified, but webGLRenderer is not specified. so engine will not render as webgl.");else{this.O=new this.S.render.webGLRendererLoader.Color;const t=this.S.render.webGLRendererInitilizer();let e,i,s;t instanceof Array?(e=t[0],i=t[1],s=!1):(e=t,i=t.domElement,s=!0);const r=this.K;this._=i,this.L=e,this.L.setSize(r.clientWidth,r.clientHeight),this._.style.position="absolute",r.appendChild(this._),this.t=new Gt(e,s?e:null),this.T.setWebGLGlobalObject(this.t)}else this.S.render.webGLRendererInitilizer&&console.warn("webGLRenderer is specified, but webGLRendererLoader is not specified. so engine will not render as webgl.");if(this.S.render.useCss3DRenderer){const t=this.K;this.R=new Lt,this.R.setSize(t.clientWidth,t.clientHeight);const e=this.R.domElement;e.style.width="100%",e.style.height="100%",e.style.position="absolute",e.style.pointerEvents="none",e.onscroll=t=>{const e=t.target;e.scrollTop=0,e.scrollLeft=0},t.appendChild(e)}if(r.build(),!this.h.camera)throw new Error("Camera is not exist or not active in the scene.");if(this.u.kind=St.Running,this.p.startProcessNonSyncedEvent(),this.I.update(this.o.deltaTime),this.l.updateAfterProcess(),!this.h.camera)throw new Error("Camera is not exist or not active in the scene.");this.p.processRemoveObject();const h=this.m.update();this.R&&this.R.render(h,this.C.unsafeGetThreeScene(),this.h.camera.threeCamera);const n=null===(i=this.t)||void 0===i?void 0:i.effectComposer;n?n.render(this.o.deltaTime):this.L&&this.L.render(this.C.unsafeGetThreeScene(),this.h.camera.threeCamera),this.m.flush(),this.l.endFrameAfterProcess(),this.j=requestAnimationFrame(this.M)}W(){var t;if(this.o.update(),this.p.startProcessNonSyncedEvent(),this.I.update(this.o.deltaTime),this.l.tryCompact(),this.l.updateAfterProcess(),!this.h.camera)throw new Error("Camera is not exist or not active in the scene.");this.p.processRemoveObject();const e=this.m.update();this.R&&this.R.render(e,this.C.unsafeGetThreeScene(),this.h.camera.threeCamera);const i=null===(t=this.t)||void 0===t?void 0:t.effectComposer;i?i.render(this.o.deltaTime):this.L&&this.L.render(this.C.unsafeGetThreeScene(),this.h.camera.threeCamera),this.m.flush(),this.l.endFrameAfterProcess(),this.j=requestAnimationFrame(this.M)}stop(){if(this.D)throw new Error("Game is disposed.");if(this.u.kind!==St.Running)throw new Error("Game is not running.");this.u.kind=St.Stopped,this.j&&cancelAnimationFrame(this.j),this.j=null}resume(){if(this.D)throw new Error("Game is disposed.");if(this.u.kind!==St.Stopped)throw new Error("Game is not stopped.");this.u.kind=St.Running,this.W()}dispose(){if(!this.D){if(this.u.kind===St.Running){this.u.kind=St.Finalizing,this.j&&cancelAnimationFrame(this.j),this.T.dispose();const t=this.C.children;for(let e=0;e<t.length;++e)t[e].gameObject.destroy();this.R&&this.K.removeChild(this.R.domElement),this._&&this.K.removeChild(this._),this.t&&this.t.dispose()}else this.T.dispose();this.A&&window.removeEventListener("resize",this.F),this.K.remove(),this.D=!0,this.u.kind=St.Finalized}}get inputHandler(){return this.T.input}get currentGameState(){return this.u.kind}}(document.body);Ie.inputHandler.startHandleEvents(),Ie.run(class extends class{constructor(t,e){this.H=t.instantiater,this.Y=e||null,this.Z=new Ht(t.sceneProcessor),this.S=new Xt(Xt.createDefaultObject())}getGameSettingObject(){return Object.freeze(this.S),this.S.make()}get instantiater(){return this.H}get interopObject(){return this.Y}get sceneBuilder(){return this.Z}get setting(){return this.S}}{run(){const t=this.instantiater,e=new Vt,i=new Vt;return this.sceneBuilder.withChild(t.buildGameObject("camera").withComponent(oe,(t=>{t.viewSize=150})).withComponent(ae,(t=>{t.setTrackTarget(i.ref)}))).withChild(t.buildGameObject("map",new F).withComponent(ye,(t=>{t.chunkSize=15})).withComponent(je,(t=>{t.playerViewDistance=5})).withComponent(Ce,(t=>{t.loadComponent=ye,t.waitComponent=je,t.load=(e,i)=>{xe.loadImageFromPath(Fe).then((s=>{t.exists&&(e.imageSources=[new ge(s,13,9)],i())}))}})).getComponent(je,e)).withChild(t.buildGameObject("test-player",new F(0,0,1)).withComponent(pe,(t=>{t.imageWidth=1,t.imageHeight=1})).withComponent(Me,(t=>{t.gridCenter=new zt(0,0),t.speed=80})).withComponent(class extends ee{worldGenerator=null;_tempVector2=new zt;update(){this.worldGenerator?.updatePlayerPosition(231,new zt(0,0));const t=this.gameObject.transform.position,e=this._tempVector2.set(t.x,t.y);this.worldGenerator?.updatePlayerPosition(this.instanceId,e)}},(t=>{t.worldGenerator=e.ref})).getGameObject(i))}})})();